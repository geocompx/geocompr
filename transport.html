<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 13 Transportation | Geocomputation with R</title>
<meta name="author" content="Robin Lovelace, Jakub Nowosad, Jannes Muenchow">
<meta name="description" content="Prerequisites This chapter uses the following packages:90 library(sf) library(dplyr) library(spDataLarge) library(stplanr)   # for processing geographic transport data library(tmap)     #...">
<meta name="generator" content="bookdown 0.43 with bs4_book()">
<meta property="og:title" content="Chapter 13 Transportation | Geocomputation with R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://r.geocompx.org/transport.html">
<meta property="og:image" content="https://r.geocompx.org/images/cover2.png">
<meta property="og:description" content="Prerequisites This chapter uses the following packages:90 library(sf) library(dplyr) library(spDataLarge) library(stplanr)   # for processing geographic transport data library(tmap)     #...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 13 Transportation | Geocomputation with R">
<meta name="twitter:description" content="Prerequisites This chapter uses the following packages:90 library(sf) library(dplyr) library(spDataLarge) library(stplanr)   # for processing geographic transport data library(tmap)     #...">
<meta name="twitter:image" content="https://r.geocompx.org/images/cover2.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Lato-0.4.10/font.css" rel="stylesheet">
<link href="libs/Roboto_Mono-0.4.10/font.css" rel="stylesheet">
<link href="libs/Montserrat-0.4.10/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><meta name="citation_title" content="Chapter 13 Transportation | Geocomputation with R">
<meta name="citation_author" content="Robin Lovelace">
<meta name="citation_author" content="Jakub Nowosad">
<meta name="citation_author" content="Jannes Muenchow">
<meta name="citation_publication_date" content="2019">
<meta name="citation_isbn" content="9780203730058">
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-99618359-1', 'auto');
      ga('send', 'pageview');

    </script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-VDC2S0ZNH5"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-VDC2S0ZNH5');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h2>
        <a href="index.html" title="">Geocomputation with R</a>
      </h2>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="foreword-1st-edition.html">Foreword (1st Edition)</a></li>
<li><a class="" href="foreword-2nd-edition.html">Foreword (2nd Edition)</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introduction</a></li>
<li class="book-part">Foundations</li>
<li><a class="" href="spatial-class.html"><span class="header-section-number">2</span> Geographic data in R</a></li>
<li><a class="" href="attr.html"><span class="header-section-number">3</span> Attribute data operations</a></li>
<li><a class="" href="spatial-operations.html"><span class="header-section-number">4</span> Spatial data operations</a></li>
<li><a class="" href="geometry-operations.html"><span class="header-section-number">5</span> Geometry operations</a></li>
<li><a class="" href="raster-vector.html"><span class="header-section-number">6</span> Raster-vector interactions</a></li>
<li><a class="" href="reproj-geo-data.html"><span class="header-section-number">7</span> Reprojecting geographic data</a></li>
<li><a class="" href="read-write.html"><span class="header-section-number">8</span> Geographic data I/O</a></li>
<li class="book-part">Extensions</li>
<li><a class="" href="adv-map.html"><span class="header-section-number">9</span> Making maps with R</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">10</span> Bridges to GIS software</a></li>
<li><a class="" href="algorithms.html"><span class="header-section-number">11</span> Scripts, algorithms and functions</a></li>
<li><a class="" href="spatial-cv.html"><span class="header-section-number">12</span> Statistical learning</a></li>
<li class="book-part">Applications</li>
<li><a class="active" href="transport.html"><span class="header-section-number">13</span> Transportation</a></li>
<li><a class="" href="location.html"><span class="header-section-number">14</span> Geomarketing</a></li>
<li><a class="" href="eco.html"><span class="header-section-number">15</span> Ecology</a></li>
<li><a class="" href="conclusion.html"><span class="header-section-number">16</span> Conclusion</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/geocompx/geocompr">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="transport" class="section level1" number="13">
<h1>
<span class="header-section-number">13</span> Transportation<a class="anchor" aria-label="anchor" href="#transport"><i class="fas fa-link"></i></a>
</h1>
<div id="prerequisites-11" class="section level2 unnumbered">
<h2>Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites-11"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>This chapter uses the following packages:<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;The &lt;strong&gt;nabor&lt;/strong&gt; package must also be installed, although it does not need to be attached.&lt;/p&gt;"><sup>90</sup></a>
</li>
</ul>
<div class="sourceCode" id="cb440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Nowosad/spData">spDataLarge</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/stplanr">stplanr</a></span><span class="op">)</span>      <span class="co"># for processing geographic transport data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap">tmap</a></span><span class="op">)</span>         <span class="co"># map-making (see Chapter 9)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>      <span class="co"># data visualization package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a></span><span class="op">)</span>   <span class="co"># spatial network classes and functions </span></span></code></pre></div>
</div>
<div id="introduction-7" class="section level2" number="13.1">
<h2>
<span class="header-section-number">13.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-7"><i class="fas fa-link"></i></a>
</h2>
<p>In few other sectors is geographic space more tangible than transportation.
The effort of moving (overcoming distance) is central to the ‘first law’ of geography, defined by Waldo Tobler in 1970 as follows <span class="citation">(<a href="references.html#ref-tobler_computer_1970">Waldo R. Tobler 1970</a>)</span>:</p>
<blockquote>
<p>Everything is related to everything else, but near things are more related than distant things.</p>
</blockquote>
<p>This ‘law’ is the basis for spatial autocorrelation and other key geographic concepts.
It applies to phenomena as diverse as friendship networks and ecological diversity and can be explained by the costs of transport — in terms of time, energy and money — which constitute the ‘friction of distance’.
From this perspective, transport technologies are disruptive, changing spatial relationships between geographic entities including mobile humans and goods: “the purpose of transportation is to overcome space” <span class="citation">(<a href="references.html#ref-rodrigue_geography_2013">Rodrigue, Comtois, and Slack 2013</a>)</span>.</p>
<p>Transport is an inherently spatial activity, involving moving from an origin point ‘A’ to a destination point ‘B’, through infinite localities in between.
It is therefore unsurprising that transport researchers have long turned to geographic and computational methods to understand movement patterns, and how interventions can improve their performance <span class="citation">(<a href="references.html#ref-lovelace_open_2021">Lovelace 2021</a>)</span>.</p>
<p>This chapter introduces the geographic analysis of transport systems at different geographic levels:</p>
<ul>
<li>
<strong>Areal units</strong>: transport patterns can be understood with reference to zonal aggregates, such as the main mode of travel (by car, bike or foot, for example), and average distance of trips made by people living in a particular zone, covered in Section <a href="transport.html#transport-zones">13.3</a>
</li>
<li>
<strong>Desire lines</strong>: straight lines that represent ‘origin-destination’ data that records how many people travel (or could travel) between places (points or zones) in geographic space, the topic of Section <a href="transport.html#desire-lines">13.4</a>
</li>
<li>
<strong>Nodes</strong>: these are points in the transport system that can represent common origins and destinations and public transport stations such as bus stops and rail stations, the topic of Section <a href="transport.html#nodes">13.5</a>
</li>
<li>
<strong>Routes</strong>: these are lines representing a path along the route network along the desire lines and between nodes.
Routes (which can be represented as single linestrings or multiple short <em>segments</em>) and the <em>routing engines</em> that generate them, are covered in Section <a href="transport.html#routes">13.6</a>
</li>
<li>
<strong>Route networks</strong>: these represent the system of roads, paths and other linear features in an area and are covered in Section <a href="transport.html#route-networks">13.7</a>.
They can be represented as geographic features (typically short segments of road that add up to create a full network) or structured as an interconnected graph, with the level of traffic on different segments referred to as ‘flow’ by transport modelers <span class="citation">(<a href="references.html#ref-hollander_transport_2016">Hollander 2016</a>)</span>
</li>
</ul>
<p>Another key level is <strong>agents</strong>, mobile entities like you and me and vehicles that enable us to move such as bikes and buses.
These can be represented computationally in software such as <a href="http://www.matsim.org/">MATSim</a> and <a href="https://github.com/a-b-street/abstreet">A/B Street</a>, which represent the dynamics of transport systems using an agent-based modeling (ABM) framework, usually at high levels of spatial and temporal resolution <span class="citation">(<a href="references.html#ref-horni_multi-agent_2016">Horni, Nagel, and Axhausen 2016</a>)</span>.
ABM is a powerful approach to transport research with great potential for integration with R’s spatial classes <span class="citation">(<a href="references.html#ref-thiele_r_2014">Thiele 2014</a>; <a href="references.html#ref-lovelace_spatial_2016">Lovelace and Dumont 2016</a>)</span>, but is outside the scope of this chapter.
Beyond geographic levels and agents, the basic unit of analysis in many transport models is the <strong>trip</strong>, a single purpose journey from an origin ‘A’ to a destination ‘B’ <span class="citation">(<a href="references.html#ref-hollander_transport_2016">Hollander 2016</a>)</span>.
Trips join-up the different levels of transport systems and can be represented simplistically as geographic <em>desire lines</em> connecting <em>zone</em> centroids (<em>nodes</em>) or as routes that follow the transport <em>route network</em>.
In this context, <em>agents</em> are usually point entities that move within the transport network.</p>
<p>Transport systems are dynamic <span class="citation">(<a href="references.html#ref-xie_evolving_2011">Xie and Levinson 2011</a>)</span>.
While the focus of this chapter is the <em>geographic</em> analysis of a transport systems, it provides insights into how the approach can be used to simulate scenarios of change, in Section <a href="transport.html#prioritizing-new-infrastructure">13.8</a>.
The purpose of geographic transport modeling can be interpreted as simplifying the complexity of these spatiotemporal systems in ways that capture their essence.
Selecting appropriate levels of geographic analysis can help simplify this complexity without losing its most important features and variables, enabling better decision-making and more effective interventions <span class="citation">(<a href="references.html#ref-hollander_transport_2016">Hollander 2016</a>)</span>.</p>
<p>Typically, models are designed to tackle a particular problem, such as how to improve safety or the environmental performance of transport systems.
For this reason, this chapter is based around a policy scenario, introduced in the next section, that asks: how to increase cycling in the city of Bristol?
Chapter <a href="location.html#location">14</a> demonstrates a related application of geocomputation: prioritizing the location of new bike shops.
There is a link between the chapters: new and effectively-located cycling infrastructure can get people cycling, boosting demand for bike shops and local economic activity.
This highlights an important feature of transport systems: they are closely linked to broader phenomena and land-use patterns.</p>
</div>
<div id="bris-case" class="section level2" number="13.2">
<h2>
<span class="header-section-number">13.2</span> A case study of Bristol<a class="anchor" aria-label="anchor" href="#bris-case"><i class="fas fa-link"></i></a>
</h2>
<p>The case study used for this chapter is located in Bristol, a city in the west of England, around 30 km east of the Welsh capital Cardiff.
An overview of the region’s transport network is illustrated in Figure <a href="transport.html#fig:bristol">13.1</a>, which shows a diversity of transport infrastructure, for cycling, public transport, and private motor vehicles.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:bristol"></span>
<img src="images/13_bristol.png" alt="Bristol's transport network represented by colored lines for active (green), public (railways, blue) and private motor (red) modes of travel. Black border lines represent the inner city boundary (highlighted in yellow) and the larger Travel To Work Area (TTWA)." width="100%"><p class="caption">
FIGURE 13.1: Bristol’s transport network represented by colored lines for active (green), public (railways, blue) and private motor (red) modes of travel. Black border lines represent the inner city boundary (highlighted in yellow) and the larger Travel To Work Area (TTWA).
</p>
</div>
<p>Bristol is the tenth largest city council in England, with a population of half a million people, although its travel catchment area is larger (see Section <a href="transport.html#transport-zones">13.3</a>).
It has a vibrant economy with aerospace, media, financial service and tourism companies, alongside two major universities.
Bristol shows a high average income per person but also contains areas of severe deprivation <span class="citation">(<a href="references.html#ref-bristol_city_council_deprivation_2015">Bristol City Council 2015</a>)</span>.</p>
<p>In terms of transport, Bristol is well served by rail and road links, and it has a relatively high level of active travel.
According to the <a href="https://www.gov.uk/government/statistical-data-sets/how-often-and-time-spent-walking-and-cycling-at-local-authority-level-cw010#table-cw0103">Active People Survey</a>, 19% of its citizens cycle and 88% walk at least once per month (the national average is 15% and 81%, respectively).
8% of the population said they cycled to work in the 2011 census, compared with only 3% nationwide.</p>
<p>Like many cities, Bristol has major congestion, air quality and physical inactivity problems.
Cycling can tackle all of these issues efficiently: it has a greater potential to replace car trips than walking, with typical <a href="https://en.wikipedia.org/wiki/Bicycle_performance">speeds</a> of 15-20 km/h vs. 4-6 km/h for walking.
For this reason, Bristol’s <a href="https://www.bristol.gov.uk/council-and-mayor/policies-plans-and-strategies/bristol-transport-strategy">Transport Strategy</a> has ambitious plans for cycling.</p>
<p>To highlight the importance of policy considerations in transportation research, this chapter is guided by the need to provide evidence for people (transport planners, politicians and other stakeholders) tasked with getting people out of cars and onto more sustainable modes — walking and cycling in particular.
The broader aim is to demonstrate how geocomputation can support evidence-based transport planning.
In this chapter you will learn how to:</p>
<ul>
<li>Describe the geographical patterns of transport behavior in cities</li>
<li>Identify key public transport nodes supporting multi-modal trips</li>
<li>Analyze travel ‘desire lines’ to find where many people drive short distances</li>
<li>Identify cycle route locations that will encourage less car driving and more cycling</li>
</ul>
<p>To get the wheels rolling on the practical aspects of this chapter, the next section begins by loading zonal data on travel patterns.
These zone-level datasets are small but often vital for gaining a basic understanding of a settlement’s overall transport system.</p>
</div>
<div id="transport-zones" class="section level2" number="13.3">
<h2>
<span class="header-section-number">13.3</span> Transport zones<a class="anchor" aria-label="anchor" href="#transport-zones"><i class="fas fa-link"></i></a>
</h2>
<p>Although transport systems are primarily based on linear features and nodes — including pathways and stations — it often makes sense to start with areal data, to break continuous space into tangible units <span class="citation">(<a href="references.html#ref-hollander_transport_2016">Hollander 2016</a>)</span>.
In addition to the boundary defining the study area (Bristol in this case), two zone types are of particular interest to transport researchers: origin and destination zones.
Often, the same geographic units are used for origins and destinations.
However, different zoning systems, such as ‘<a href="https://www.data.gov.uk/dataset/022e455a-b5cc-4247-bfc5-1aaf9da78379/workplace-zones-a-new-geography-for-workplace-statistics">Workplace Zones</a>’, may be appropriate to represent the increased density of trip destinations in areas with many ‘trip attractors’ such as schools and shops <span class="citation">(<a href="references.html#ref-office_for_national_statistics_workplace_2014">Office for National Statistics 2014</a>)</span>.</p>
<p>The simplest way to define a study area is often the first matching boundary returned by OpenStreetMap.
This can be done with a command such as <code>osmdata::getbb("Bristol", format_out = "sf_polygon",  limit = 1)</code>.
This returns an <code>sf</code> object (or a list of <code>sf</code> objects if <code>limit = 1</code> is not specified) representing the bounds of the largest matching city region, either a rectangular polygon of the bounding box or a detailed polygonal boundary.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;In cases where the first match does not provide the right name, the country or region should be specified, for example &lt;code&gt;Bristol Tennessee&lt;/code&gt; for a Bristol located in America.&lt;/p&gt;"><sup>91</sup></a>
For Bristol, a detailed polygon is returned, as represented by the <code>bristol_region</code> object in the <strong>spDataLarge</strong> package.
See the inner blue boundary in Figure <a href="transport.html#fig:bristol">13.1</a>: there are a couple of issues with this approach:</p>
<ul>
<li>The first boundary returned by OSM may not be the official boundary used by local authorities</li>
<li>Even if OSM returns the official boundary, this may be inappropriate for transport research because they bear little relation to where people travel</li>
</ul>
<p>Travel To Work Areas (TTWAs) address these issues by creating a zoning system analogous to hydrological watersheds.
TTWAs were first defined as contiguous zones within which 75% of the population travels to work <span class="citation">(<a href="references.html#ref-coombes_efficient_1986">Coombes, Green, and Openshaw 1986</a>)</span>, and this is the definition used in this chapter.
Because Bristol is a major employer attracting travel from surrounding towns, its TTWA is substantially larger than the city bounds (see Figure <a href="transport.html#fig:bristol">13.1</a>).
The polygon representing this transport-orientated boundary is stored in the object <code>bristol_ttwa</code>, provided by the <strong>spDataLarge</strong> package loaded at the beginning of this chapter.</p>
<p>The origin and destination zones used in this chapter are the same: officially defined zones of intermediate geographic resolution (their <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/bulletins/annualsmallareapopulationestimates/2014-10-23">official</a> name is Middle layer Super Output Areas or MSOAs).
Each houses around 8,000 people.
Such administrative zones can provide vital context to transport analysis, such as the type of people who might benefit most from particular interventions (e.g., <span class="citation">Moreno-Monroy, Lovelace, and Ramos (<a href="references.html#ref-moreno-monroy_public_2017">2017</a>)</span>).</p>
<p>The geographic resolution of these zones is important: small zones with high geographic resolution are usually preferable, but their high number in large regions can have consequences for processing.
This is especially true for origin-destination (OD) analysis in which the number of possibilities increases as a non-linear function of the number of zones <span class="citation">(<a href="references.html#ref-hollander_transport_2016">Hollander 2016</a>)</span>.</p>
<div class="rmdnote">
<p>
Another issue with small zones is related to anonymity rules. To make
it impossible to infer the identity of individuals in zones, detailed
socio-demographic variables are often only available at a low geographic
resolution. Breakdowns of travel mode by age and sex, for example, are
available at the Local Authority level in the UK, but not at the much
higher Output Area level, each of which contains around 100 households.
For further details, see www.ons.gov.uk/methodology/geography.
</p>
</div>
<p>The 102 zones used in this chapter are stored in <code>bristol_zones</code>, as illustrated in Figure <a href="transport.html#fig:zones">13.2</a>.
Note the zones get smaller in densely populated areas: each houses a similar number of people.
<code>bristol_zones</code> contains no attribute data on transport, however, only the name and code of each zone:</p>
<div class="sourceCode" id="cb441"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html">names</a></span><span class="op">(</span><span class="va">bristol_zones</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "geo_code" "name"     "geometry"</span></span></code></pre></div>
<p>To add travel data, we will perform an <em>attribute join</em>, a common task described in Section <a href="attr.html#vector-attribute-joining">3.2.4</a>.
We will use travel data from the UK’s 2011 census question on travel to work, data stored in <code>bristol_od</code>, which was provided by the <a href="https://www.ons.gov.uk/help/localstatistics">ons.gov.uk</a> data portal.
<code>bristol_od</code> is an OD dataset on travel to work between zones from the UK’s 2011 Census (see Section <a href="transport.html#desire-lines">13.4</a>).
The first column is the ID of the zone of origin and the second column is the zone of destination.
<code>bristol_od</code> has more rows than <code>bristol_zones</code>, representing travel <em>between</em> zones rather than the zones themselves:</p>
<div class="sourceCode" id="cb442"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">bristol_od</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2910</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">bristol_zones</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 102</span></span></code></pre></div>
<p>The results of the previous code chunk shows that there are more than 10 OD pairs for every zone, meaning we will need to aggregate the origin-destination data before it is joined with <code>bristol_zones</code>, as illustrated below (OD data is described in Section <a href="transport.html#desire-lines">13.4</a>).</p>
<div class="sourceCode" id="cb443"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zones_attr</span> <span class="op">=</span> <span class="va">bristol_od</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>geo_code <span class="op">=</span> <span class="va">o</span><span class="op">)</span></span></code></pre></div>
<p>The preceding chunk:</p>
<ul>
<li>Grouped the data by zone of origin (contained in the column <code>o</code>)</li>
<li>Aggregated the variables in the <code>bristol_od</code> dataset <em>if</em> they were numeric, to find the total number of people living in each zone by mode of transport<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;The &lt;code&gt;_if&lt;/code&gt; affix requires a &lt;code&gt;TRUE&lt;/code&gt;/&lt;code&gt;FALSE&lt;/code&gt; question to be asked of the variables, in this case ‘is it numeric?’ and only variables returning true are summarized.&lt;/p&gt;"><sup>92</sup></a>
</li>
<li>Renamed the grouping variable <code>o</code> so it matches the ID column <code>geo_code</code> in the <code>bristol_zones</code> object</li>
</ul>
<p>The resulting object <code>zones_attr</code> is a data frame with rows representing zones and an ID variable.
We can verify that the IDs match those in the <code>zones</code> dataset using the <code>%in%</code> operator as follows:</p>
<div class="sourceCode" id="cb444"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html">summary</a></span><span class="op">(</span><span class="va">zones_attr</span><span class="op">$</span><span class="va">geo_code</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html">%in%</a></span> <span class="va">bristol_zones</span><span class="op">$</span><span class="va">geo_code</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Mode    TRUE </span></span>
<span><span class="co">#&gt; logical     102</span></span></code></pre></div>
<p>The results show that all 102 zones are present in the new object and that <code>zone_attr</code> is in a form that can be joined onto the zones.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;It would also be important to check that IDs match in the opposite direction on real data.
This could be done by changing the order of the IDs in the &lt;code&gt;summary()&lt;/code&gt; command — &lt;code&gt;summary(bristol_zones$geo_code %in% zones_attr$geo_code)&lt;/code&gt; — or by using &lt;code&gt;setdiff()&lt;/code&gt; as follows: &lt;code&gt;setdiff(bristol_zones$geo_code, zones_attr$geo_code)&lt;/code&gt;.&lt;/p&gt;"><sup>93</sup></a>
This is done using the joining function <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> (note that <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> would produce here the same result): </p>
<div class="sourceCode" id="cb445"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zones_joined</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">bristol_zones</span>, <span class="va">zones_attr</span>, by <span class="op">=</span> <span class="st">"geo_code"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">zones_joined</span><span class="op">$</span><span class="va">all</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 238805</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html">names</a></span><span class="op">(</span><span class="va">zones_joined</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "geo_code"   "name"       "all"        "bicycle"    "foot"      </span></span>
<span><span class="co">#&gt; [6] "car_driver" "train"      "geometry"</span></span></code></pre></div>
<p>The result is <code>zones_joined</code>, which contains new columns representing the total number of trips originating in each zone in the study area (almost 1/4 of a million) and their mode of travel (by bicycle, foot, car and train).
The geographic distribution of trip origins is illustrated in the left-hand panel in Figure <a href="transport.html#fig:zones">13.2</a>.
This shows that most zones have between 0 and 4,000 trips originating from them in the study area.
More trips are made by people living near the center of Bristol and fewer on the outskirts.
Why is this?
Remember that we are only dealing with trips within the study region: low trip numbers in the outskirts of the region can be explained by the fact that many people in these peripheral zones will travel to other regions outside of the study area.
Trips outside the study region can be included in a regional model by a special destination ID covering any trips that go to a zone not represented in the model <span class="citation">(<a href="references.html#ref-hollander_transport_2016">Hollander 2016</a>)</span>.
The data in <code>bristol_od</code>, however, simply ignores such trips: it is an ‘intra-zonal’ model.</p>
<p>In the same way that OD datasets can be aggregated to the zone of origin, they can also be aggregated to provide information about destination zones.
People tend to gravitate towards central places.
This explains why the spatial distribution represented in the right panel in Figure <a href="transport.html#fig:zones">13.2</a> is relatively uneven, with the most common destination zones concentrated in Bristol city center.
The result is <code>zones_od</code>, which contains a new column reporting the number of trip destinations by any mode, and it is created as follows:</p>
<div class="sourceCode" id="cb446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zones_destinations</span> <span class="op">=</span> <span class="va">bristol_od</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>geo_code <span class="op">=</span> <span class="va">d</span>, all_dest <span class="op">=</span> <span class="va">all</span><span class="op">)</span></span>
<span><span class="va">zones_od</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">zones_joined</span>, <span class="va">zones_destinations</span>, by <span class="op">=</span> <span class="st">"geo_code"</span><span class="op">)</span></span></code></pre></div>
<p>A simplified version of Figure <a href="transport.html#fig:zones">13.2</a> is created with the code below (see <code>13-zones.R</code> in the <a href="https://github.com/geocompx/geocompr/tree/main/code"><code>code</code></a> folder of the book’s GitHub repository to reproduce the figure and Section <a href="adv-map.html#faceted-maps">9.2.7</a> for details on faceted maps with <strong>tmap</strong>):</p>
<div class="sourceCode" id="cb447"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/qtm.html">qtm</a></span><span class="op">(</span><span class="va">zones_od</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"all_dest"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>panel.labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Origin"</span>, <span class="st">"Destination"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:zones"></span>
<img src="figures/zones-1.png" alt="Number of trips (commuters) living and working in the region. The left map shows zone of origin of commute trips; the right map shows zone of destination (generated by the script `13-zones.R`)." width="100%"><p class="caption">
FIGURE 13.2: Number of trips (commuters) living and working in the region. The left map shows zone of origin of commute trips; the right map shows zone of destination (generated by the script <code>13-zones.R</code>).
</p>
</div>
</div>
<div id="desire-lines" class="section level2" number="13.4">
<h2>
<span class="header-section-number">13.4</span> Desire lines<a class="anchor" aria-label="anchor" href="#desire-lines"><i class="fas fa-link"></i></a>
</h2>
<p>Desire lines connect origins and destinations, representing where people <em>desire</em> to go, typically between zones.
They represent the quickest ‘bee line’ or ‘crow flies’ route between A and B that would be taken, if it were not for obstacles such as buildings and windy roads getting in the way (we will see how to convert desire lines into routes in the next section).
Typically, desire lines are represented geographically as starting and ending in the geographic (or population weighted) centroid of each zone.
This is the type of desire line that we will create and use in this section, although it is worth being aware of ‘jittering’ techniques that enable multiple start and end points to increase the spatial coverage and accuracy of analyses building on OD data <span class="citation">(<a href="references.html#ref-lovelace_jittering_2022b">Lovelace, Félix, and Carlino 2022</a>)</span>.</p>
<p>We have already loaded data representing desire lines in the dataset <code>bristol_od</code>.
This data frame represents the number of people traveling between the zone represented in <code>o</code> and <code>d</code>, as illustrated in Table <a href="transport.html#tab:od">13.1</a>.
To arrange the OD data by all trips and then filter-out only the top 5, type (please refer to Chapter <a href="attr.html#attr">3</a> for a detailed description of non-spatial attribute operations):</p>
<div class="sourceCode" id="cb448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od_top5</span> <span class="op">=</span> <span class="va">bristol_od</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">all</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:od">TABLE 13.1: </span>Sample of the top 5 origin-destination pairs in the Bristol OD data frame, representing travel desire lines between zones in the study area.</caption>
<thead><tr class="header">
<th align="left">o</th>
<th align="left">d</th>
<th align="right">all</th>
<th align="right">bicycle</th>
<th align="right">foot</th>
<th align="right">car_driver</th>
<th align="right">train</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">E02003043</td>
<td align="left">E02003043</td>
<td align="right">1493</td>
<td align="right">66</td>
<td align="right">1296</td>
<td align="right">64</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">E02003047</td>
<td align="left">E02003043</td>
<td align="right">1300</td>
<td align="right">287</td>
<td align="right">751</td>
<td align="right">148</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">E02003031</td>
<td align="left">E02003043</td>
<td align="right">1221</td>
<td align="right">305</td>
<td align="right">600</td>
<td align="right">176</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">E02003037</td>
<td align="left">E02003043</td>
<td align="right">1186</td>
<td align="right">88</td>
<td align="right">908</td>
<td align="right">110</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">E02003034</td>
<td align="left">E02003043</td>
<td align="right">1177</td>
<td align="right">281</td>
<td align="right">711</td>
<td align="right">100</td>
<td align="right">7</td>
</tr>
</tbody>
</table></div>
<p>The resulting table provides a snapshot of Bristolian travel patterns in terms of commuting (travel to work).
It demonstrates that walking is the most popular mode of transport among the top 5 OD pairs, that zone <code>E02003043</code> is a popular destination (Bristol city center, the destination of all the top 5 OD pairs), and that the <em>intrazonal</em> trips, from one part of zone <code>E02003043</code> to another (first row of Table <a href="transport.html#tab:od">13.1</a>), constitute the most traveled OD pair in the dataset.
But from a policy perspective, the raw data presented in Table <a href="transport.html#tab:od">13.1</a> is of limited use: aside from the fact that it contains only a tiny portion of the 2,910 OD pairs, it tells us little about <em>where</em> policy measures are needed, or <em>what proportion</em> of trips are made by walking and cycling.
The following command calculates the percentage of each desire line that is made by these active modes:</p>
<div class="sourceCode" id="cb449"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bristol_od</span><span class="op">$</span><span class="va">Active</span> <span class="op">=</span> <span class="op">(</span><span class="va">bristol_od</span><span class="op">$</span><span class="va">bicycle</span> <span class="op">+</span> <span class="va">bristol_od</span><span class="op">$</span><span class="va">foot</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="va">bristol_od</span><span class="op">$</span><span class="va">all</span> <span class="op">*</span> <span class="fl">100</span></span></code></pre></div>
<p>There are two main types of OD pairs: <em>interzonal</em> and <em>intrazonal</em>.
Interzonal OD pairs represent travel between zones in which the destination is different from the origin.
Intrazonal OD pairs represent travel within the same zone (see the top row of Table <a href="transport.html#tab:od">13.1</a>).
The following code chunk splits <code>od_bristol</code> into these two types:</p>
<div class="sourceCode" id="cb450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od_intra</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">bristol_od</span>, <span class="va">o</span> <span class="op">==</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="va">od_inter</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">bristol_od</span>, <span class="va">o</span> <span class="op">!=</span> <span class="va">d</span><span class="op">)</span></span></code></pre></div>
<p>The next step is to convert the interzonal OD pairs into an <code>sf</code> object representing desire lines that can be plotted on a map with the <strong>stplanr</strong> function <code><a href="https://docs.ropensci.org/stplanr/reference/od2line.html">od2line()</a></code>.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;code&gt;od2line()&lt;/code&gt; works by matching the IDs in the first two columns of the &lt;code&gt;bristol_od&lt;/code&gt; object to the &lt;code&gt;zone_code&lt;/code&gt; ID column in the geographic &lt;code&gt;zones_od&lt;/code&gt; object.
Note that the operation emits a warning because &lt;code&gt;od2line()&lt;/code&gt; works by allocating the start and end points of each origin-destination pair to the &lt;em&gt;centroid&lt;/em&gt; of its zone of origin and destination.
For real-world use one would use centroid values generated from projected data or, preferably, use &lt;em&gt;population-weighted&lt;/em&gt; centroids &lt;span class="citation"&gt;(&lt;a href="references.html#ref-lovelace_propensity_2017"&gt;Lovelace et al. 2017&lt;/a&gt;)&lt;/span&gt;.&lt;/p&gt;'><sup>94</sup></a></p>
<div class="sourceCode" id="cb451"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">desire_lines</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/stplanr/reference/od2line.html">od2line</a></span><span class="op">(</span><span class="va">od_inter</span>, <span class="va">zones_od</span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating centroids representing desire line start and end points.</span></span></code></pre></div>
<p>An illustration of the results is presented in Figure <a href="transport.html#fig:desire">13.3</a>, a simplified version of which is created with the following command (see the code in <code>13-desire.R</code> to reproduce the figure exactly and Chapter <a href="adv-map.html#adv-map">9</a> for details on visualization with <strong>tmap</strong>):</p>
<div class="sourceCode" id="cb452"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/qtm.html">qtm</a></span><span class="op">(</span><span class="va">desire_lines</span>, lines.lwd <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:desire"></span>
<img src="figures/desire-1.png" alt="Desire lines representing trip patterns in Bristol, with width representing number of trips and color representing the percentage of trips made by active modes (walking and cycling). The four black lines represent the interzonal OD pairs in Table 13.1." width="100%"><p class="caption">
FIGURE 13.3: Desire lines representing trip patterns in Bristol, with width representing number of trips and color representing the percentage of trips made by active modes (walking and cycling). The four black lines represent the interzonal OD pairs in Table 13.1.
</p>
</div>
<p>The map shows that the city center dominates transport patterns in the region, suggesting policies should be prioritized there, although a number of peripheral sub-centers can also be seen.
Desire lines are important generalized components of transport systems.
More concrete components include nodes, which have specific destinations (rather than hypothetical straight lines represented in desire lines).
Nodes are covered in the next section.</p>
</div>
<div id="nodes" class="section level2" number="13.5">
<h2>
<span class="header-section-number">13.5</span> Nodes<a class="anchor" aria-label="anchor" href="#nodes"><i class="fas fa-link"></i></a>
</h2>
<p>Nodes in geographic transport datasets are points among the predominantly linear features that comprise transport networks.
Broadly are two main types of transport nodes:</p>
<ol style="list-style-type: decimal">
<li>Nodes not directly on the network such as zone centroids or individual origins and destinations such as houses and workplaces</li>
<li>Nodes that are a part of transport networks.
Technically, a node can be located at any point on a transport network but in practice they are often special kinds of vertex such as intersections between pathways (junctions) and points for entering or exiting a transport network such as bus stops and train stations<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;The function &lt;a href="https://luukvdmeer.github.io/sfnetworks/reference/st_network_blend.html"&gt;&lt;code&gt;st_network_blend()&lt;/code&gt;&lt;/a&gt; from the &lt;strong&gt;sfnetworks&lt;/strong&gt; package allows new nodes to be created on the network based on proximity to arbitrary points on or off the network.&lt;/p&gt;'><sup>95</sup></a>
</li>
</ol>
<p>Transport networks can be represented as graphs, in which each segment is connected (via edges representing geographic lines) to one or more other edges in the network.
Nodes outside the network can be added with “centroid connectors”, new route segments to nearby nodes on the network <span class="citation">(<a href="references.html#ref-hollander_transport_2016">Hollander 2016</a>)</span>.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;The location of these connectors should be chosen carefully because they can lead to over-estimates of traffic volumes in their immediate surroundings &lt;span class="citation"&gt;(&lt;a href="references.html#ref-jafari_investigation_2015"&gt;Jafari et al. 2015&lt;/a&gt;)&lt;/span&gt;.&lt;/p&gt;'><sup>96</sup></a>
Every node in the network is then connected by one or more ‘edges’ that represent individual segments on the network.
We will see how transport networks can be represented as graphs in Section <a href="transport.html#route-networks">13.7</a>.</p>
<p>Public transport stops are particularly important nodes that can be represented as either type of node: a bus stop that is part of a road, or a large rail station that is represented by its pedestrian entry point hundreds of meters from railway tracks.
We will use railway stations to illustrate public transport nodes, in relation to the research question of increasing cycling in Bristol.
These stations are provided by <strong>spDataLarge</strong> in <code>bristol_stations</code>.</p>
<p>A common barrier preventing people from switching away from cars for commuting to work is that the distance from home to work is too far to walk or cycle.
Public transport can reduce this barrier by providing a fast and high-volume option for common routes into cities.
From an active travel perspective, public transport ‘legs’ of longer journeys divide trips into three:</p>
<ul>
<li>The origin leg, typically from residential areas to public transport stations</li>
<li>The public transport leg, which typically goes from the station nearest a trip’s origin to the station nearest its destination</li>
<li>The destination leg, from the station of alighting to the destination</li>
</ul>
<p>Building on the analysis conducted in Section <a href="transport.html#desire-lines">13.4</a>, public transport nodes can be used to construct three-part desire lines for trips that can be taken by bus and (the mode used in this example) rail.
The first stage is to identify the desire lines with most public transport travel, which in our case is easy because our previously created dataset <code>desire_lines</code> already contains a variable describing the number of trips by train (the public transport potential could also be estimated using public transport routing services such as <a href="http://www.opentripplanner.org/">OpenTripPlanner</a>).
To make the approach easier to follow, we will select only the top three desire lines in terms of rails use:</p>
<div class="sourceCode" id="cb453"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">desire_rail</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span><span class="op">(</span><span class="va">desire_lines</span>, n <span class="op">=</span> <span class="fl">3</span>, wt <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span></code></pre></div>
<p>The challenge now is to ‘break-up’ each of these lines into three pieces, representing travel via public transport nodes.
This can be done by converting a desire line into a multilinestring object consisting of three line geometries representing origin, public transport and destination legs of the trip.
This operation can be divided into three stages: matrix creation (of origins, destinations and the ‘via’ points representing rail stations), identification of nearest neighbors and conversion to multilinestrings.
These are undertaken by <code><a href="https://docs.ropensci.org/stplanr/reference/line_via.html">line_via()</a></code>.
This <strong>stplanr</strong> function takes input lines and points and returns a copy of the desire lines — see the <a href="https://docs.ropensci.org/stplanr/reference/line_via.html"><code>?line_via()</code></a> for details on how this works.
The output is the same as the input line, except it has new geometry columns representing the journey via public transport nodes, as demonstrated below:</p>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html">ncol</a></span><span class="op">(</span><span class="va">desire_rail</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 9</span></span>
<span><span class="va">desire_rail</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/stplanr/reference/line_via.html">line_via</a></span><span class="op">(</span><span class="va">desire_rail</span>, <span class="va">bristol_stations</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html">ncol</a></span><span class="op">(</span><span class="va">desire_rail</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 12</span></span></code></pre></div>
<p>As illustrated in Figure <a href="transport.html#fig:stations">13.4</a>, the initial <code>desire_rail</code> lines now have three additional geometry list columns representing travel from home to the origin station, from there to the destination, and finally from the destination station to the destination.
In this case, the destination leg is very short (walking distance), but the origin legs may be sufficiently far to justify investment in cycling infrastructure to encourage people to cycle to the stations on the outward leg of peoples’ journey to work in the residential areas surrounding the three origin stations in Figure <a href="transport.html#fig:stations">13.4</a>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:stations"></span>
<img src="figures/stations-1.png" alt="Station nodes (red dots) used as intermediary points that convert straight desire lines with high rail usage (thin green lines) into three legs: to the origin station (orange) via public transport (blue) and to the destination (pink, not visible because it is short)." width="100%"><p class="caption">
FIGURE 13.4: Station nodes (red dots) used as intermediary points that convert straight desire lines with high rail usage (thin green lines) into three legs: to the origin station (orange) via public transport (blue) and to the destination (pink, not visible because it is short).
</p>
</div>
</div>
<div id="routes" class="section level2" number="13.6">
<h2>
<span class="header-section-number">13.6</span> Routes<a class="anchor" aria-label="anchor" href="#routes"><i class="fas fa-link"></i></a>
</h2>
<p>
From a geographical perspective, routes are desire lines that are no longer straight: the origin and destination points are the same as in the desire line representation of travel, but the pathway to get from A to B is more complex.
The geometries of routes are typically (but not always) determined by the transport network.</p>
<p>While desire lines contain only two vertices (their beginning and end points), routes can contain any number of vertices, representing points between A and B joined by straight lines: the definition of a linestring geometry.
Routes covering large distances or following intricate networks can have thousands of vertices; routes on grid-based or simplified road networks tend to have fewer.</p>
<p>Routes are generated from desire lines or, more commonly, matrices containing coordinate pairs representing desire lines.
This routing process is done by a range of broadly-defined <em>routing engines</em>: software and web services that return geometries and attributes describing how to get from origins to destinations.
Routing engines can be classified based on <em>where</em> they run relative to R:</p>
<ul>
<li>In-memory routing using R packages that enable route calculation (described in Section <a href="transport.html#memengine">13.6.2</a>)</li>
<li>Locally hosted routing engines external to R that can be called from R (Section <a href="transport.html#localengine">13.6.3</a>)</li>
<li>Remotely hosted routing engines by external entities that provide a web API that can be called from R (Section <a href="transport.html#remoteengine">13.6.4</a>)</li>
</ul>
<p>Before describing each, it is worth outlining other ways of categorizing routing engines.
Routing engines can be multi-modal, meaning that they can calculate trips composed of more than one mode of transport, or not.
Multi-modal routing engines can return results consisting of multiple <em>legs</em>, each one made by a different mode of transport.
The optimal route from a residential area to a commercial area could involve (1) walking to the nearest bus stop, (2) catching the bus to the nearest node to the destination, and (3) walking to the destination, given a set of input parameters.
The transition points between these three legs are commonly referred to as ‘ingress’ and ‘egress’, meaning getting on/off a public transport vehicle.
Multi-modal routing engines such as R5 are more sophisticated and have larger input data requirements than ‘uni-modal’ routing engines such as the OpenStreetMap Routing Machine (OSRM), described in Section <a href="transport.html#localengine">13.6.3</a>.</p>
<p>A major strength of multi-modal engines is their ability to represent ‘transit’ (public transport) trips by trains, buses, etc.
Multi-model routing engines require input datasets representing public transport networks, typically in General Transit Feed Specification (<a href="https://developers.google.com/transit/gtfs">GTFS</a>) files, which can be processed with functions in the <a href="https://r-transit.github.io/tidytransit/index.html"><strong>tidytransit</strong></a> and <a href="https://ipeagit.github.io/gtfstools/"><strong>gtfstools</strong></a> packages (other packages and tools for working with GTFS files are available).
Single mode routing engines may be sufficient for projects focused on specific (non-public) modes of transport.
Another way of classifying routing engines (or settings) is by the geographic level of the outputs: routes, legs and segments.</p>
<div id="route-legs-segments" class="section level3" number="13.6.1">
<h3>
<span class="header-section-number">13.6.1</span> Routes, legs and segments<a class="anchor" aria-label="anchor" href="#route-legs-segments"><i class="fas fa-link"></i></a>
</h3>
<p>Routing engines can generate outputs at three geographic levels of routes, legs and segments:</p>
<ul>
<li>
<strong>Route</strong> level outputs contain a single feature (typically a multilinestring and associated row in the data frame representation) per origin-destination pair, meaning a single row of data per trip</li>
<li>
<strong>Leg</strong> level outputs contain a single feature and associated attributes each <em>mode</em> within each origin-destination (OD) pair, as described in Section <a href="transport.html#nodes">13.5</a>. For trips only involving one mode (for example driving, from home to work, ignoring the short walk to the car), the leg is the same as the route: the car journey. For trips involving public transport, legs provide key information. The <strong>r5r</strong> function <code>detailed_itineraries()</code> returns legs which, confusingly, are sometimes referred to as ‘segments’</li>
<li>Segment-level outputs provide the most detailed information about routes, with records for each small section of the transport network. Typically segments are similar in length, or identical to, ways in OpenStreetMap. The <strong>cyclestreets</strong> function <code>journey()</code> returns data at the segment-level which can be aggregated by grouping by origin- and destination-level data returned by the <code><a href="https://docs.ropensci.org/stplanr/reference/route.html">route()</a></code> function in <strong>stplanr</strong>
</li>
</ul>
<p>Most routing engines return route-level by default, although multi-modal engines generally provide outputs at the leg level (one feature per continuous movement by a single mode of transport).
Segment-level outputs have the advantage of providing more detail.
The <strong>cyclestreets</strong> package returns multiple ‘quietness’ levels per route, enabling identification of the ‘weakest link’ in cycle networks.
Disadvantages of segment-level outputs include increased file sizes and complexities associated with the extra detail.</p>
<p>Route-level results can be converted into segment-level results using the function <code><a href="https://docs.ropensci.org/stplanr/reference/overline.html">stplanr::overline()</a></code> <span class="citation">(<a href="references.html#ref-morgan_travel_2020">Morgan and Lovelace 2020</a>)</span>.
When working with segment- or leg-level data, route-level statistics can be returned by grouping by columns representing trip start and end points and summarizing/aggregating columns containing segment-level data.</p>
</div>
<div id="memengine" class="section level3" number="13.6.2">
<h3>
<span class="header-section-number">13.6.2</span> In-memory routing with R<a class="anchor" aria-label="anchor" href="#memengine"><i class="fas fa-link"></i></a>
</h3>
<p>Routing engines in R enable route networks stored as R objects <em>in memory</em> to be used as the basis of route calculation.
Options include <a href="https://luukvdmeer.github.io/sfnetworks/"><strong>sfnetworks</strong></a>, <a href="https://urbananalyst.github.io/dodgr/"><strong>dodgr</strong></a> and <a href="https://github.com/vlarmet/cppRouting"><strong>cppRouting</strong></a> packages, each of which provide its own class system to represent route networks, the topic of the next section.</p>
<p>While fast and flexible, native R routing options are generally harder to set up than dedicated routing engines for realistic route calculation.
Routing is a hard problem and many hundreds of hours have been put into open source routing engines that can be downloaded and hosted locally.
On the other hand, R-based routing engines may be well suited to model experiments and the statistical analysis of the impacts of changes on the network.
Changing route network characteristics (or weights associated with different route segment types), recalculating routes, and analyzing results under many scenarios in a single language have benefits for research applications.</p>
</div>
<div id="localengine" class="section level3" number="13.6.3">
<h3>
<span class="header-section-number">13.6.3</span> Locally hosted dedicated routing engines<a class="anchor" aria-label="anchor" href="#localengine"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Locally hosted</strong> routing engines include OpenTripPlanner, <a href="https://github.com/valhalla/valhalla">Valhalla</a>, and R5 (which are multi-modal), and the OpenStreetMap Routing Machine (OSRM) (which is ‘uni-modal’).
These can be accessed from R with the packages <strong>opentripplanner</strong>, <a href="https://github.com/chris31415926535/valhallr"><strong>valhallr</strong></a>, <strong>r5r</strong> and <a href="https://github.com/riatelab/osrm"><strong>osrm</strong></a> <span class="citation">(<a href="references.html#ref-morgan_opentripplanner_2019">Morgan et al. 2019</a>; <a href="references.html#ref-pereira_r5r_2021">Pereira et al. 2021</a>)</span>.
Locally hosted routing engines run on the user’s computer but in a process separate from R.
They benefit from speed of execution and control over the weighting profile for different modes of transport.
Disadvantages include the difficulty of representing complex networks locally, lack of predefined routing profiles, temporal dynamics (e.g. traffic), and the need to install specialized software.</p>
</div>
<div id="remoteengine" class="section level3" number="13.6.4">
<h3>
<span class="header-section-number">13.6.4</span> Remotely hosted dedicated routing engines<a class="anchor" aria-label="anchor" href="#remoteengine"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Remotely hosted</strong> routing engines use a web API to send queries about origins and destinations and return results.
Routing services based on open source routing engines, such as OSRM’s publicly available service, work the same when called from R as locally hosted instances, simply requiring arguments specifying ‘base URLs’ to be updated.
However, the fact that external routing services are hosted on a dedicated machine (usually funded by a commercial company with incentives to generate accurate routes) can give them advantages, including:</p>
<ul>
<li>Provision of routing services worldwide (or usually at least over a large region)</li>
<li>Established routing services are usually updated regularly and can often respond to traffic levels</li>
<li>Routing services usually run on dedicated hardware and software including systems such as load balancers to ensure consistent performance</li>
</ul>
<p>Disadvantages of remote routing services include speed when batch jobs are not possible (they often rely on data transfer over the internet on a route-by-route basis), price (the Google routing API, for example, limits the number of free queries) and licensing issues.
<a href="http://symbolixau.github.io/googleway/"><strong>googleway</strong></a> and <a href="https://walker-data.com/mapboxapi/articles/navigation.html"><strong>mapbox</strong></a> packages demonstrate this approach by providing access to routing services from Google and Mapbox, respectively.
Free (but rate limited) routing service include <a href="http://project-osrm.org/">OSRM</a> and <a href="https://openrouteservice.org/">openrouteservice.org</a> which can be accessed from R with the <a href="https://rgeomatic.hypotheses.org/category/osrm"><strong>osrm</strong></a> and <a href="https://github.com/GIScience/openrouteservice-r"><strong>openrouteservice</strong></a> packages, the latter of which is not on CRAN.
There are also more specific routing services such as that provided by <a href="https://www.cyclestreets.net/">CycleStreets.net</a>, a cycle journey planner and not-for-profit transport technology company “for cyclists, by cyclists”.
While R users can access CycleStreets routes via the package <a href="https://rpackage.cyclestreets.net/"><strong>cyclestreets</strong></a>, many routing services lack R interfaces, representing a substantial opportunity for package development: building an R package to provide an interface to a web API can be a rewarding experience.</p>
</div>
<div id="contraction-hierarchies-and-traffic-assigment" class="section level3" number="13.6.5">
<h3>
<span class="header-section-number">13.6.5</span> Contraction hierarchies and traffic assigment<a class="anchor" aria-label="anchor" href="#contraction-hierarchies-and-traffic-assigment"><i class="fas fa-link"></i></a>
</h3>
<p>Contraction hierarchies and traffic assignment are advanced but important topics in transport modeling that are worth being aware of, especially if you want your code to scale to large networks.
Calculating many routes is computationally resource intensive and can take hours, leading to the development of several algorithms to speed up routing calculations.
<strong>Contraction hierarchies</strong> is a well-known algorithm that can lead to a substantial (1000x+ in some cases) speed up in routing tasks, depending on network size.
Contraction hierarchies are used behind the scenes in the routing engines mentioned in the previous sections.</p>
<p>Traffic assignment is a problem that is closely related to routing: in practice, the shortest path between two points is not always the fastest, especially if there is congestion.
The process takes OD datasets, of the kind described in Section <a href="transport.html#desire-lines">13.4</a>, and assigns traffic to each segment in the network, generating route networks of the kind described in Section <a href="transport.html#route-networks">13.7</a>.
An established solution is Wardrop’s principle of user equilibrium which shows that, to be realistic, congestion should be considered when estimating flows on the network, with reference to a mathematically defined relationship between cost and flow <span class="citation">(<a href="references.html#ref-wardrop_theoretical_1952">Wardrop 1952</a>)</span>.
This optimization problem can be solved by iterative algorithms which are implemented in the <a href="https://github.com/vlarmet/cppRouting"><strong>cppRouting</strong></a> package, which also implements contraction hierarchies for fast routing.</p>
</div>
<div id="routing-a-worked-example" class="section level3" number="13.6.6">
<h3>
<span class="header-section-number">13.6.6</span> Routing: A worked example<a class="anchor" aria-label="anchor" href="#routing-a-worked-example"><i class="fas fa-link"></i></a>
</h3>
<p>Instead of routing <em>all</em> desire lines generated in Section <a href="transport.html#desire-lines">13.4</a>, we focus on a subset that is highly policy-relevant.
Running a computationally intensive operation on a subset before trying to process the whole dataset is often sensible, and this applies to routing.
Routing can be time- and memory-consuming, resulting in large objects, due to the detailed geometries and extra attributes of route objects.
We will therefore filter the desire lines before calculating routes in this section.</p>
<p>Cycling is most beneficial when it replaces car trips.
Short trips (around 5 km, which can be cycled in 15 minutes at a speed of 20 km/hr) have a relatively high probability of being cycled, and the maximum distance increases when trips are made by electric bike <span class="citation">(<a href="references.html#ref-lovelace_propensity_2017">Lovelace et al. 2017</a>)</span>.
These considerations inform the following code chunk which filters the desire lines and returns the object <code>desire_lines_short</code> representing OD pairs between which many (100+) short (2.5 to 5 km Euclidean distance) trips are driven:</p>
<div class="sourceCode" id="cb455"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">desire_lines</span><span class="op">$</span><span class="va">distance_km</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_length</a></span><span class="op">(</span><span class="va">desire_lines</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1000</span></span>
<span><span class="va">desire_lines_short</span> <span class="op">=</span> <span class="va">desire_lines</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">car_driver</span> <span class="op">&gt;=</span> <span class="fl">100</span>, <span class="va">distance_km</span> <span class="op">&lt;=</span> <span class="fl">5</span>, <span class="va">distance_km</span> <span class="op">&gt;=</span> <span class="fl">2.5</span><span class="op">)</span></span></code></pre></div>
<p>In the code above, <code><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_length()</a></code> calculated the length of each desire line, as described in Section <a href="spatial-operations.html#distance-relations">4.2.3</a>.
The <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function from <strong>dplyr</strong> filtered the <code>desire_lines</code> dataset based on the criteria outlined above, as described in Section <a href="attr.html#vector-attribute-subsetting">3.2.1</a>.
The next stage is to convert these desire lines into routes.
This is done using the publicly available OSRM service with the <strong>stplanr</strong> functions <code><a href="https://docs.ropensci.org/stplanr/reference/route.html">route()</a></code> and <code><a href="https://docs.ropensci.org/stplanr/reference/route_osrm.html">route_osrm()</a></code> in the code chunk below:</p>
<div class="sourceCode" id="cb456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">routes_short</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/stplanr/reference/route.html">route</a></span><span class="op">(</span>l <span class="op">=</span> <span class="va">desire_lines_short</span>, route_fun <span class="op">=</span> <span class="va">route_osrm</span>,</span>
<span>                     osrm.profile <span class="op">=</span> <span class="st">"car"</span><span class="op">)</span></span></code></pre></div>
<p>The output is <code>routes_short</code>, an <code>sf</code> object representing routes on the transport network that are suitable for cycling (according to the OSRM routing engine at least), one for each desire line.
Note: calls to external routing engines such as in the command above only work with an internet connection (and sometimes an API key stored in an environment variable, although not in this case).
In addition to the columns contained in the <code>desire_lines</code> object, the new route dataset contains <code>distance</code> (referring to route distance this time) and <code>duration</code> columns (in seconds), which provide potentially useful extra information on the nature of each route.
We will plot desire lines along which many short car journeys take place alongside cycling routes.
Making the width of the routes proportional to the number of car journeys that could potentially be replaced provides an effective way to prioritize interventions on the road network <span class="citation">(<a href="references.html#ref-lovelace_propensity_2017">Lovelace et al. 2017</a>)</span>.
Figure <a href="transport.html#fig:routes">13.5</a> shows routes along which people drive short distances (see the github.com/geocompx for the source code).<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Note that the red routes and black desire lines do not start at exactly the same points.
This is because zone centroids rarely lie on the route network; instead the routes originate from the transport network node nearest the centroid.
Note also that routes are assumed to originate in the zone centroids, a simplifying assumption which is used in transport models to reduce the computational resources needed to calculate the shortest path between all combinations of possible origins and destinations &lt;span class="citation"&gt;(&lt;a href="references.html#ref-hollander_transport_2016"&gt;Hollander 2016&lt;/a&gt;)&lt;/span&gt;.&lt;/p&gt;'><sup>97</sup></a></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:routes"></span>
<img src="figures/routes-1.png" alt="Routes along which many (100+) short (&lt;5km Euclidean distance) car journeys are made (red) overlaying desire lines representing the same trips (black) and zone centroids (dots)." width="100%"><p class="caption">
FIGURE 13.5: Routes along which many (100+) short (&lt;5km Euclidean distance) car journeys are made (red) overlaying desire lines representing the same trips (black) and zone centroids (dots).
</p>
</div>
<p>Visualizing the results in an interactive map shows that many short car trips take place in and around Bradley Stoke, around 10 km North of central Bristol.
It is easy to find explanations for the area’s high level of car-dependency: according to <a href="https://en.wikipedia.org/wiki/Bradley_Stoke">Wikipedia</a>, Bradley Stoke is “Europe’s largest new town built with private investment”, suggesting limited public transport provision.
Furthermore, the town is surrounded by large (cycling unfriendly) road structures, including the M4 and M5 motorways <span class="citation">(<a href="references.html#ref-tallon_bristol_2007">Tallon 2007</a>)</span>.</p>
<p>There are many benefits of converting travel desire lines into routes.
It is important to remember that we cannot be sure how many (if any) trips will follow the exact routes calculated by routing engines.
However, route and street/way/segment-level results can be highly policy-relevant.
Route segment results can enable the prioritization of investment where it is most needed, according to available data <span class="citation">(<a href="references.html#ref-lovelace_propensity_2017">Lovelace et al. 2017</a>)</span>.</p>
</div>
</div>
<div id="route-networks" class="section level2" number="13.7">
<h2>
<span class="header-section-number">13.7</span> Route networks<a class="anchor" aria-label="anchor" href="#route-networks"><i class="fas fa-link"></i></a>
</h2>
<p>
While routes generally contain data on travel <em>behavior</em>, at the same geographic level as desire lines and OD pairs, route network datasets usually represent the physical transport network.
Each <em>segment</em> in a route network roughly corresponds to a continuous section of street between junctions and appears only once, although the average length of segments depends on the data source (segments in the OSM-derived <code>bristol_ways</code> dataset used in this section have an average length of just over 200 m, with a standard deviation of nearly 500 m).
Variability in segment lengths can be explained by the fact that in some rural locations junctions are far apart, while in dense urban areas there are crossings and other segment breaks every few meters.</p>
<p>Route networks can be an input into, or an output of, transport data analysis projects, or both.
Any transport research that involves route calculation requires a route network dataset in the internal or external routing engines (in the latter case the route network data is not necessarily imported into R).
However, route networks are also important outputs in many transport research projects: summarizing data such as the potential number of trips made on particular segments and represented as a route network, can help prioritize investment where it is most needed.
</p>
<p>To demonstrate how to create route networks as an output derived from route-level data, imagine a simple scenario of mode shift.
Imagine that 50% of car trips between 0 to 3 km in route distance are replaced by cycling, a percentage that drops by 10 percentage points for every additional kilometer of route distance so that 20% of car trips of 6 km are replaced by cycling and no car trips that are eight km or longer are replaced by cycling.
This is of course an unrealistic scenario <span class="citation">(<a href="references.html#ref-lovelace_propensity_2017">Lovelace et al. 2017</a>)</span>, but is a useful starting point.
In this case, we can model mode shift from cars to bikes as follows:</p>
<div class="sourceCode" id="cb457"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uptake</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">3</span> <span class="op">~</span> <span class="fl">0.5</span>,</span>
<span>    <span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">8</span> <span class="op">~</span> <span class="fl">0</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="op">(</span><span class="fl">8</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">8</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">routes_short_scenario</span> <span class="op">=</span> <span class="va">routes_short</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>uptake <span class="op">=</span> <span class="fu">uptake</span><span class="op">(</span><span class="va">distance</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bicycle <span class="op">=</span> <span class="va">bicycle</span> <span class="op">+</span> <span class="va">car_driver</span> <span class="op">*</span> <span class="va">uptake</span>,</span>
<span>         car_driver <span class="op">=</span> <span class="va">car_driver</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">uptake</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">routes_short_scenario</span><span class="op">$</span><span class="va">bicycle</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">routes_short</span><span class="op">$</span><span class="va">bicycle</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3255</span></span></code></pre></div>
<p>Having created a scenario in which approximately 4000 trips have switched from driving to cycling, we can now model where this updated modeled cycling activity will take place.
For this, we will use the function <code><a href="https://docs.ropensci.org/stplanr/reference/overline.html">overline()</a></code> from the <strong>stplanr</strong> package.
The function breaks linestrings at junctions (where two or more linestring geometries meet), and calculates aggregate statistics for each unique route segment <span class="citation">(<a href="references.html#ref-morgan_travel_2020">Morgan and Lovelace 2020</a>)</span>, taking an object containing routes and the names of the attributes to summarize as the first and second argument:</p>
<div class="sourceCode" id="cb458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">route_network_scenario</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/stplanr/reference/overline.html">overline</a></span><span class="op">(</span><span class="va">routes_short_scenario</span>, attrib <span class="op">=</span> <span class="st">"bicycle"</span><span class="op">)</span></span></code></pre></div>
<p>The outputs of the two preceding code chunks are summarized in Figure <a href="transport.html#fig:rnetvis">13.6</a> below.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:rnetvis"></span>
<img src="figures/rnetvis-1.png" alt="The percentage of car trips switching to cycling as a function of distance (left) and route network level results of this function (right)." width="49%"><img src="figures/rnetvis-2.png" alt="The percentage of car trips switching to cycling as a function of distance (left) and route network level results of this function (right)." width="49%"><p class="caption">
FIGURE 13.6: The percentage of car trips switching to cycling as a function of distance (left) and route network level results of this function (right).
</p>
</div>
<p>Transport networks with records at the segment-level, typically with attributes such as road type and width, constitute a common type of route network.
Such route network datasets are available worldwide from OpenStreetMap, and can be downloaded with packages such as <strong>osmdata</strong> and <strong>osmextract</strong>.
To save time downloading and preparing OSM, we will use the <code>bristol_ways</code> object from the <strong>spDataLarge</strong> package, an <code>sf</code> object with LINESTRING geometries and attributes representing a sample of the transport network in the case study region (see <code><a href="https://rdrr.io/pkg/spDataLarge/man/bristol_ways.html">?bristol_ways</a></code> for details), as shown in the output below:</p>
<div class="sourceCode" id="cb459"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html">summary</a></span><span class="op">(</span><span class="va">bristol_ways</span><span class="op">)</span></span>
<span><span class="co">#&gt;      highway       maxspeed             ref                     geometry   </span></span>
<span><span class="co">#&gt;  cycleway:1721   Length:6160        Length:6160        LINESTRING   :6160  </span></span>
<span><span class="co">#&gt;  rail    :1017   Class :character   Class :character   epsg:4326    :   0  </span></span>
<span><span class="co">#&gt;  road    :3422   Mode  :character   Mode  :character   +proj=long...:   0</span></span></code></pre></div>
<p>The output shows that <code>bristol_ways</code> represents just over 6,000 segments on the transport network.
This and other geographic networks can be represented as mathematical graphs, with nodes on the network, connected by edges.
A number of R packages have been developed for dealing with such graphs, notably <strong>igraph</strong>.
You can manually convert a route network into an <code>igraph</code> object, but the geographic attributes will be lost.
To overcome this limitation of <strong>igraph</strong>, the <strong>sfnetworks</strong> package was developed <span class="citation">(<a href="references.html#ref-R-sfnetworks">van der Meer et al. 2023</a>)</span>.
It represents networks simultaneously as graphs <em>and</em> geographic lines and has a ‘tidy’ syntax, as demonstrated in the following example.</p>
<div class="sourceCode" id="cb460"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bristol_ways</span><span class="op">$</span><span class="va">lengths</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html">st_length</a></span><span class="op">(</span><span class="va">bristol_ways</span><span class="op">)</span></span>
<span><span class="va">ways_sfn</span> <span class="op">=</span> <span class="fu"><a href="https://luukvdmeer.github.io/sfnetworks/reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">bristol_ways</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">ways_sfn</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sfnetwork" "tbl_graph" "igraph"</span></span></code></pre></div>
<div class="sourceCode" id="cb461"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ways_sfn</span></span>
<span><span class="co">#&gt; # A sfnetwork with 5728 nodes and 4915 edges</span></span>
<span><span class="co">#&gt; # A directed multigraph with 1013 components with spatially explicit edges</span></span>
<span><span class="co">#&gt; # Node Data:     5,728 × 1 (active)</span></span>
<span><span class="co">#&gt; # Edge Data:     4,915 × 7</span></span>
<span><span class="co">#&gt;    from    to highway maxspeed ref                              geometry lengths</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;fct&gt;   &lt;fct&gt;    &lt;fct&gt;                    &lt;LINESTRING [°]&gt;     [m]</span></span>
<span><span class="co">#&gt; 1     1     2 road    &lt;NA&gt;     B3130 (-2.61 51.4, -2.61 51.4, -2.61 51.…    218.</span></span>
<span><span class="co">#&gt; # … </span></span></code></pre></div>
<p>The output of the previous code chunk (with the final output shortened to contain only the most important eight lines due to space considerations) shows that <code>ways_sfn</code> is a composite object, containing both nodes and edges in graph and spatial form.
<code>ways_sfn</code> is of class <code>sfnetwork</code>, which builds on the <code>igraph</code> class from the <strong>igraph</strong> package.
In the example below, the ‘edge betweenness’, meaning the number of shortest paths passing through each edge, is calculated (see <code><a href="https://r.igraph.org/reference/betweenness.html">?igraph::betweenness</a></code> for further details).
The output of the edge betweenness calculation is shown in Figure <a href="transport.html#fig:wayssln">13.7</a>, which has the cycle route network dataset calculated with the <code><a href="https://docs.ropensci.org/stplanr/reference/overline.html">overline()</a></code> function as an overlay for comparison.
The results demonstrate that each graph edge represents a segment: the segments near the center of the road network have the highest betweenness values, whereas segments closer to central Bristol have higher cycling potential, based on these simplistic datasets.</p>
<div class="sourceCode" id="cb462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ways_centrality</span> <span class="op">=</span> <span class="va">ways_sfn</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"edges"</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>betweenness <span class="op">=</span> <span class="fu">tidygraph</span><span class="fu">::</span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/centrality.html">centrality_edge_betweenness</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code>#&gt; [plot mode] legend/component: Some components or legends are too "wide" and are
#&gt; therefore rescaled.
#&gt; ℹ Set the tmap option `component.autoscale = FALSE` to disable rescaling.</code></pre>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:wayssln"></span>
<img src="figures/wayssln-1.png" alt="Route network datasets. The gray lines represent a simplified road network, with segment thickness proportional to betweenness. The green lines represent potential cycling flows (one way) calculated with the code above." width="100%"><p class="caption">
FIGURE 13.7: Route network datasets. The gray lines represent a simplified road network, with segment thickness proportional to betweenness. The green lines represent potential cycling flows (one way) calculated with the code above.
</p>
</div>
<p>One can also find the shortest route between origins and destinations using this graph representation of the route network with the <strong>sfnetworks</strong> package.
<!-- TODO: make an exercise based on this if time allows (RL 2022-07) -->
The methods presented in this section are relatively simple compared with what is possible.
The possibilities opened-up by <strong>sfnetworks</strong> cannot be fully covered in this section, but it does provide a strong starting point for further exploration and research into the area.
A final point is that the example dataset we used above is relatively small.
It may also be worth considering how the work could adapt to larger networks: testing methods on a subset of the data, and ensuring you have enough RAM will help, although it’s also worth exploring other tools that can do transport network analysis that are optimized for large networks, such as R5 <span class="citation">(<a href="references.html#ref-alessandretti_multimodal_2022">Alessandretti et al. 2022</a>)</span>.</p>
</div>
<div id="prioritizing-new-infrastructure" class="section level2" number="13.8">
<h2>
<span class="header-section-number">13.8</span> Prioritizing new infrastructure<a class="anchor" aria-label="anchor" href="#prioritizing-new-infrastructure"><i class="fas fa-link"></i></a>
</h2>
<p>This section demonstrates how geocomputation can create policy-relevant outcomes in the field of transport planning.
We will identify promising locations for investment in sustainable transport infrastructure, using a simple approach for educational purposes.</p>
<p>An advantage of the data-driven approach outlined in this chapter is its modularity: each aspect can be useful on its own, and feed into wider analyses.
The steps that got us to this stage included identifying short but car-dependent commuting routes (generated from desire lines) in Section <a href="transport.html#routes">13.6</a> and analysis of route network characteristics with the <strong>sfnetworks</strong> package in Section <a href="transport.html#route-networks">13.7</a>.
The final code chunk of this chapter combines these strands of analysis, by overlaying estimates of cycling potential from the previous section on top of a new dataset representing areas within a short distance of cycling infrastructure.
This new dataset is created in the code chunk below which: (1) filters out the cycleway entities from the <code>bristol_ways</code> object representing the transport network,(2) ‘unions’ the individual LINESTRING entities of the cycleways into a single multilinestring object (for speed of buffering),and (3) creates a 100 m buffer around them to create a polygon.</p>
<div class="sourceCode" id="cb464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">existing_cycleways_buffer</span> <span class="op">=</span> <span class="va">bristol_ways</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"cycleway"</span><span class="op">)</span> <span class="op">|&gt;</span>    <span class="co"># 1) filter out cycleways</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_union</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span>                       <span class="co"># 2) unite geometries</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_buffer</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>               <span class="co"># 3) create buffer</span></span></code></pre></div>
<p>The next stage is to create a dataset representing points on the network where there is high cycling potential but little provision for cycling.</p>
<div class="sourceCode" id="cb465"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">route_network_no_infra</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">st_difference</a></span><span class="op">(</span></span>
<span>  <span class="va">route_network_scenario</span>,</span>
<span>  <span class="va">route_network_scenario</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_set_crs</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">existing_cycleways_buffer</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">existing_cycleways_buffer</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The results of the preceding code chunks are shown in Figure <a href="transport.html#fig:cycleways">13.8</a>, which shows routes with high levels of car-dependency and high cycling potential but no cycleways.</p>
<div class="sourceCode" id="cb466"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">"view"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/qtm.html">qtm</a></span><span class="op">(</span><span class="va">route_network_no_infra</span>, basemaps <span class="op">=</span> <span class="fu">leaflet</span><span class="fu">::</span><span class="va"><a href="https://rstudio.github.io/leaflet/reference/providers.html">providers</a></span><span class="op">$</span><span class="va">Esri.WorldTopoMap</span>,</span>
<span>    lines.lwd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<!-- toDo: rl -->
<!-- the next figure must be updated -->
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:cycleways"></span>
<img src="figures/cycleways-1.png" alt="Potential routes along which to prioritize cycle infrastructure in Bristol to reduce car-dependency. The static map provides an overview of the overlay between existing infrastructure and routes with high car-bike switching potential (left). The screenshot the interactive map generated from the `qtm()` function highlights Whiteladies Road as somewhere that would benefit from a new cycleway (right)." width="50%"><img src="images/bristol_cycleways_zoomed.png" alt="Potential routes along which to prioritize cycle infrastructure in Bristol to reduce car-dependency. The static map provides an overview of the overlay between existing infrastructure and routes with high car-bike switching potential (left). The screenshot the interactive map generated from the `qtm()` function highlights Whiteladies Road as somewhere that would benefit from a new cycleway (right)." width="50%"><p class="caption">
FIGURE 13.8: Potential routes along which to prioritize cycle infrastructure in Bristol to reduce car-dependency. The static map provides an overview of the overlay between existing infrastructure and routes with high car-bike switching potential (left). The screenshot the interactive map generated from the <code><a href="https://r-tmap.github.io/tmap/reference/qtm.html">qtm()</a></code> function highlights Whiteladies Road as somewhere that would benefit from a new cycleway (right).
</p>
</div>
<p>The method has some limitations: in reality, people do not travel to zone centroids or always use the shortest route algorithm for a particular mode.
However, the results demonstrate how geographic data analysis can be used to highlight places where new investment in cycleways could be particularly beneficial, despite the simplicity of the approach.
The analysis would need to be substantially expanded — including with larger input datasets — to inform transport planning design in practice.</p>
</div>
<div id="future-directions-of-travel" class="section level2" number="13.9">
<h2>
<span class="header-section-number">13.9</span> Future directions of travel<a class="anchor" aria-label="anchor" href="#future-directions-of-travel"><i class="fas fa-link"></i></a>
</h2>
<p>This chapter provided a taste of the possibilities of using geocomputation for transport research, and it explored some key geographic elements that make-up a city’s transport system with open data and reproducible code.
The results could help plan where investment is needed.</p>
<p>Transport systems operate at multiple interacting levels, meaning that geocomputational methods have great potential to generate insights into how they work, and the likely impacts of different interventions.
There is much more that could be done in this area: it would be possible to build on the foundations presented in this chapter in many directions.
Transport is the fastest growing source of greenhouse gas emissions in many countries, and it is set to become “the largest GHG emitting sector, especially in developed countries” (see <a href="https://www.euractiv.com/section/agriculture-food/opinion/transport-needs-to-do-a-lot-more-to-fight-climate-change/">EURACTIV.com</a>).
Transport-related emissions are unequally distributed across society but (unlike food and heating) are not essential for well-being.
There is great potential for the sector to rapidly decarbonize through demand reduction, electrification of the vehicle fleet and the uptake of active travel modes such as walking and cycling.
New technologies can reduce car-dependency by enabling more car sharing.
‘Micro-mobility’ systems such as dockless bike and e-scooter schemes are also emerging, creating valuable datasets in the General Bikeshare Feed Specification (GBFS) format, which can be imported and processed with the <a href="https://github.com/simonpcouch/gbfs"><strong>gbfs</strong></a> package.
These and other changes will have large impacts on accessibility, the ability of people to reach employment and service locations that they need, something that can be quantified currently and under scenarios of change with packages such as <a href="https://ipeagit.github.io/accessibility/"><strong>accessibility</strong></a> packages.
Further exploration of such ‘transport futures’ at local, regional and national levels could yield important new insights.</p>
<p>Methodologically, the foundations presented in this chapter could be extended by including more variables in the analysis.
Characteristics of the route such as speed limits, busyness and the provision of protected cycling and walking paths could be linked to ‘mode-split’ (the proportion of trips made by different modes of transport).
By aggregating OpenStreetMap data using buffers and geographic data methods presented in Chapters <a href="attr.html#attr">3</a> and <a href="spatial-operations.html#spatial-operations">4</a>, for example, it would be possible to detect the presence of green space in close proximity to transport routes.
Using R’s statistical modeling capabilities, this could then be used to predict current and future levels of cycling, for example.</p>
<p>This type of analysis underlies the Propensity to Cycle Tool (PCT), a publicly accessible (see <a href="https://www.pct.bike/">www.pct.bike</a>) mapping tool developed in R that is being used to prioritize investment in cycling across England <span class="citation">(<a href="references.html#ref-lovelace_propensity_2017">Lovelace et al. 2017</a>)</span>.
Similar tools could be used to encourage evidence-based transport policies related to other topics such as air pollution and public transport access around the world.</p>
</div>
<div id="ex-transport" class="section level2" number="13.10">
<h2>
<span class="header-section-number">13.10</span> Exercises<a class="anchor" aria-label="anchor" href="#ex-transport"><i class="fas fa-link"></i></a>
</h2>
<p>E1. In much of the analysis presented in the chapter, we focused on active modes, but what about driving trips?</p>
<ul>
<li>What proportion of trips in the <code>desire_lines</code> object are made by driving?</li>
<li>What proportion of <code>desire_lines</code> have a straight line length of 5 km or more in distance?</li>
<li>What proportion of trips in desire lines that are longer than 5 km in length are made by driving?</li>
<li>Plot the desire lines that are both less than 5 km in length and along which more than 50% of trips are made by car.</li>
<li>What do you notice about the location of these car-dependent yet short desire lines?</li>
</ul>
<p>E2. What additional length of cycleways would be built if all the sections beyond 100 m from existing cycleways in Figure 13.8, were constructed?</p>
<p>E3. What proportion of trips represented in the <code>desire_lines</code> are accounted for in the <code>routes_short_scenario</code> object?</p>
<ul>
<li>Bonus: what proportion of all trips happen on desire lines that cross <code>routes_short_scenario</code>?</li>
</ul>
<p>E4. The analysis presented in this chapter is designed for teaching how geocomputation methods can be applied to transport research.
If you were doing this for real, in government or for a transport consultancy, what top 3 things would you do differently?</p>
<p>E5. Clearly, the routes identified in Figure 13.8 only provide part of the picture.
How would you extend the analysis?</p>
<p>E6. Imagine that you want to extend the scenario by creating key <em>areas</em> (not routes) for investment in place-based cycling policies such as car-free zones, cycle parking points and reduced car parking strategy.
How could raster datasets assist with this work?</p>
<ul>
<li>Bonus: develop a raster layer that divides the Bristol region into 100 cells (10 x 10) and estimate the average speed limit of roads in each, from the <code>bristol_ways</code> dataset (see Chapter <a href="location.html#location">14</a>).</li>
</ul>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="spatial-cv.html"><span class="header-section-number">12</span> Statistical learning</a></div>
<div class="next"><a href="location.html"><span class="header-section-number">14</span> Geomarketing</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <h2>Second Edition</h2>
    <!--<p>Now is a great time to provide feedback</p>-->
        <ul class="list-unstyled">
<!--<li><a href="https://forms.gle/nq9RmbxJyZXQgc948">Provide feedback (5 min)</a></li>--><li><a href="https://geocompx.org/">Visit the geocompx website 🌐</a></li>
          <li><a href="https://r.geocompx.org/#reproducibility">Install updated packages 💾</a></li>
          <li><a href="https://github.com/geocompx/geocompr/issues">Open an issue <i class="fas fa-question"></i></a></li>
          <li><a href="https://discord.gg/PMztXYgNxp">Chat on Discord <i class="fab fa-discord"></i></a></li>
          <li><a href="https://r.geocompx.org/solutions/">Check exercise solutions <i class="fa fa-check"></i></a></li>
          <li><a href="https://supportukrainenow.org/">Support Ukraine 🇺🇦</a></li>
          <li><a href="https://donate.stripe.com/4gweWl94Q9E35AQ6oo">Support this project 💸</a></li>
        </ul>
<hr>
<nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#transport"><span class="header-section-number">13</span> Transportation</a></li>
<li><a class="nav-link" href="#prerequisites-11">Prerequisites</a></li>
<li><a class="nav-link" href="#introduction-7"><span class="header-section-number">13.1</span> Introduction</a></li>
<li><a class="nav-link" href="#bris-case"><span class="header-section-number">13.2</span> A case study of Bristol</a></li>
<li><a class="nav-link" href="#transport-zones"><span class="header-section-number">13.3</span> Transport zones</a></li>
<li><a class="nav-link" href="#desire-lines"><span class="header-section-number">13.4</span> Desire lines</a></li>
<li><a class="nav-link" href="#nodes"><span class="header-section-number">13.5</span> Nodes</a></li>
<li>
<a class="nav-link" href="#routes"><span class="header-section-number">13.6</span> Routes</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#route-legs-segments"><span class="header-section-number">13.6.1</span> Routes, legs and segments</a></li>
<li><a class="nav-link" href="#memengine"><span class="header-section-number">13.6.2</span> In-memory routing with R</a></li>
<li><a class="nav-link" href="#localengine"><span class="header-section-number">13.6.3</span> Locally hosted dedicated routing engines</a></li>
<li><a class="nav-link" href="#remoteengine"><span class="header-section-number">13.6.4</span> Remotely hosted dedicated routing engines</a></li>
<li><a class="nav-link" href="#contraction-hierarchies-and-traffic-assigment"><span class="header-section-number">13.6.5</span> Contraction hierarchies and traffic assigment</a></li>
<li><a class="nav-link" href="#routing-a-worked-example"><span class="header-section-number">13.6.6</span> Routing: A worked example</a></li>
</ul>
</li>
<li><a class="nav-link" href="#route-networks"><span class="header-section-number">13.7</span> Route networks</a></li>
<li><a class="nav-link" href="#prioritizing-new-infrastructure"><span class="header-section-number">13.8</span> Prioritizing new infrastructure</a></li>
<li><a class="nav-link" href="#future-directions-of-travel"><span class="header-section-number">13.9</span> Future directions of travel</a></li>
<li><a class="nav-link" href="#ex-transport"><span class="header-section-number">13.10</span> Exercises</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/geocompx/geocompr/blob/main/13-transport.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/geocompx/geocompr/edit/main/13-transport.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Geocomputation with R</strong>" was written by Robin Lovelace, Jakub Nowosad, Jannes Muenchow. It was last built on 2025-06-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
