<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 8 Geographic data I/O | Geocomputation with R</title>
<meta name="author" content="Robin Lovelace, Jakub Nowosad, Jannes Muenchow">
<meta name="description" content="Prerequisites This chapter requires the following packages: library(sf) library(terra) library(dplyr) library(spData)  8.1 Introduction This chapter is about reading and writing geographic data....">
<meta name="generator" content="bookdown 0.43 with bs4_book()">
<meta property="og:title" content="Chapter 8 Geographic data I/O | Geocomputation with R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://r.geocompx.org/read-write.html">
<meta property="og:image" content="https://r.geocompx.org/images/cover2.png">
<meta property="og:description" content="Prerequisites This chapter requires the following packages: library(sf) library(terra) library(dplyr) library(spData)  8.1 Introduction This chapter is about reading and writing geographic data....">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 Geographic data I/O | Geocomputation with R">
<meta name="twitter:description" content="Prerequisites This chapter requires the following packages: library(sf) library(terra) library(dplyr) library(spData)  8.1 Introduction This chapter is about reading and writing geographic data....">
<meta name="twitter:image" content="https://r.geocompx.org/images/cover2.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Lato-0.4.10/font.css" rel="stylesheet">
<link href="libs/Roboto_Mono-0.4.10/font.css" rel="stylesheet">
<link href="libs/Montserrat-0.4.10/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><meta name="citation_title" content="Chapter 8 Geographic data I/O | Geocomputation with R">
<meta name="citation_author" content="Robin Lovelace">
<meta name="citation_author" content="Jakub Nowosad">
<meta name="citation_author" content="Jannes Muenchow">
<meta name="citation_publication_date" content="2019">
<meta name="citation_isbn" content="9780203730058">
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-99618359-1', 'auto');
      ga('send', 'pageview');

    </script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-VDC2S0ZNH5"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-VDC2S0ZNH5');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h2>
        <a href="index.html" title="">Geocomputation with R</a>
      </h2>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="foreword-1st-edition.html">Foreword (1st Edition)</a></li>
<li><a class="" href="foreword-2nd-edition.html">Foreword (2nd Edition)</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introduction</a></li>
<li class="book-part">Foundations</li>
<li><a class="" href="spatial-class.html"><span class="header-section-number">2</span> Geographic data in R</a></li>
<li><a class="" href="attr.html"><span class="header-section-number">3</span> Attribute data operations</a></li>
<li><a class="" href="spatial-operations.html"><span class="header-section-number">4</span> Spatial data operations</a></li>
<li><a class="" href="geometry-operations.html"><span class="header-section-number">5</span> Geometry operations</a></li>
<li><a class="" href="raster-vector.html"><span class="header-section-number">6</span> Raster-vector interactions</a></li>
<li><a class="" href="reproj-geo-data.html"><span class="header-section-number">7</span> Reprojecting geographic data</a></li>
<li><a class="active" href="read-write.html"><span class="header-section-number">8</span> Geographic data I/O</a></li>
<li class="book-part">Extensions</li>
<li><a class="" href="adv-map.html"><span class="header-section-number">9</span> Making maps with R</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">10</span> Bridges to GIS software</a></li>
<li><a class="" href="algorithms.html"><span class="header-section-number">11</span> Scripts, algorithms and functions</a></li>
<li><a class="" href="spatial-cv.html"><span class="header-section-number">12</span> Statistical learning</a></li>
<li class="book-part">Applications</li>
<li><a class="" href="transport.html"><span class="header-section-number">13</span> Transportation</a></li>
<li><a class="" href="location.html"><span class="header-section-number">14</span> Geomarketing</a></li>
<li><a class="" href="eco.html"><span class="header-section-number">15</span> Ecology</a></li>
<li><a class="" href="conclusion.html"><span class="header-section-number">16</span> Conclusion</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/geocompx/geocompr">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="read-write" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Geographic data I/O<a class="anchor" aria-label="anchor" href="#read-write"><i class="fas fa-link"></i></a>
</h1>
<div id="prerequisites-6" class="section level2 unnumbered">
<h2>Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites-6"><i class="fas fa-link"></i></a>
</h2>
<p>This chapter requires the following packages:</p>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jakubnowosad.com/spData/">spData</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div id="introduction-4" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-4"><i class="fas fa-link"></i></a>
</h2>
<p>This chapter is about reading and writing geographic data.
Geographic data <em>input</em> is essential for geocomputation: real-world applications are impossible without data.
Data <em>output</em> is also vital, enabling others to use valuable new or improved datasets resulting from your work.
Taken together, these processes of input/output can be referred to as data I/O.
Geographic data I/O is often done in haste at the beginning and end of projects and otherwise ignored.
However, data import and export are fundamental to the success or otherwise of projects: small I/O mistakes made at the beginning of projects (e.g., using an out-of-date dataset) can lead to large problems down the line.</p>
<p>There are many geographic file formats, each with its own advantages and disadvantages, as described in Section <a href="read-write.html#file-formats">8.2</a>.
Reading and writing from and to these file formats is covered in Sections <a href="read-write.html#data-input">8.3</a> and <a href="read-write.html#data-output">8.4</a>, respectively.
In terms of where to <em>find</em> data, Section <a href="read-write.html#retrieving-data">8.5</a> describes <em>geoportals</em> and how to import data from them.
Dedicated packages to ease geographic data import, from sources including OpenStreetMap, are described in Section <a href="read-write.html#geographic-data-packages">8.6</a>.
If you want to put your data ‘into production’ in web services (or if you want to be sure that your data adheres to established standards), geographic metadata is important, as described in Section <a href="read-write.html#geographic-metadata">8.7</a>.
Another possibility to obtain spatial data is to use web services, outlined in Section <a href="read-write.html#geographic-web-services">8.8</a>.
The final Section <a href="read-write.html#visual-outputs">8.9</a> demonstrates methods for saving visual outputs (maps), in preparation for Chapter <a href="adv-map.html#adv-map">9</a> on visualization.</p>
</div>
<div id="file-formats" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> File formats<a class="anchor" aria-label="anchor" href="#file-formats"><i class="fas fa-link"></i></a>
</h2>
<p>
Geographic datasets are usually stored as files or in spatial databases.
File formats can either store vector or raster data, while spatial databases such as <a href="https://postgis.net/">PostGIS</a> can store both (see also Section <a href="gis.html#postgis">10.7</a>).
Today the variety of file formats may seem bewildering, but there has been much consolidation and standardization since the beginnings of GIS software in the 1960s when the first widely distributed program (<a href="https://news.harvard.edu/gazette/story/2011/10/the-invention-of-gis/">SYMAP</a>) for spatial analysis was created at Harvard University <span class="citation">(<a href="references.html#ref-coppock_history_1991">Coppock and Rhind 1991</a>)</span>.</p>
<p>
GDAL (which should be pronounced “goo-dal”, with the double “o” making a reference to object-orientation), Geospatial Data Abstraction Library, has resolved many issues associated with incompatibility between geographic file formats since its release in 2000.
GDAL provides a unified and high-performance interface for reading and writing many raster and vector data formats.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;As we mentioned in Chapter &lt;a href="geometry-operations.html#geometry-operations"&gt;5&lt;/a&gt;, GDAL also contains a set of utility functions allowing for raster mosaicing, resampling, cropping, and reprojecting, etc.&lt;/p&gt;'><sup>40</sup></a>
Many open and proprietary GIS programs, including GRASS GIS, ArcGIS and QGIS, use GDAL behind their GUIs for doing the legwork of ingesting and spitting out geographic data in appropriate formats.</p>
<p>GDAL provides access to more than 200 vector and raster data formats.
Table <a href="read-write.html#tab:formats">8.1</a> presents some basic information about selected and often used spatial file formats.</p>
<div class="inline-table"><table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:formats">TABLE 8.1: </span><span id="tab:formats">TABLE 8.2: </span>Selected spatial file formats.
</caption>
<thead><tr>
<th style="text-align:left;">
Name
</th>
<th style="text-align:left;">
Extension
</th>
<th style="text-align:left;">
Information
</th>
<th style="text-align:left;">
Type
</th>
<th style="text-align:left;">
Model
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
ESRI Shapefile
</td>
<td style="text-align:left;width: 5em; ">
.shp (the main file)
</td>
<td style="text-align:left;width: 12em; ">
Popular format consisting of at least three files. No support for: files &gt; 2 GB; mixed types; names &gt; 10 chars; cols &gt; 255.
</td>
<td style="text-align:left;width: 4em; ">
Vector
</td>
<td style="text-align:left;width: 5em; ">
Partially open
</td>
</tr>
<tr>
<td style="text-align:left;">
GeoJSON
</td>
<td style="text-align:left;width: 5em; ">
.geojson
</td>
<td style="text-align:left;width: 12em; ">
Extends the JSON exchange format by including a subset of the simple feature representation; mostly used for storing coordinates in longitude and latitude; it is extended by the TopoJSON format.
</td>
<td style="text-align:left;width: 4em; ">
Vector
</td>
<td style="text-align:left;width: 5em; ">
Open
</td>
</tr>
<tr>
<td style="text-align:left;">
KML
</td>
<td style="text-align:left;width: 5em; ">
.kml
</td>
<td style="text-align:left;width: 12em; ">
XML-based format for spatial visualization, developed for use with Google Earth. Zipped KML file forms the KMZ format.
</td>
<td style="text-align:left;width: 4em; ">
Vector
</td>
<td style="text-align:left;width: 5em; ">
Open
</td>
</tr>
<tr>
<td style="text-align:left;">
GPX
</td>
<td style="text-align:left;width: 5em; ">
.gpx
</td>
<td style="text-align:left;width: 12em; ">
XML schema created for exchange of GPS data.
</td>
<td style="text-align:left;width: 4em; ">
Vector
</td>
<td style="text-align:left;width: 5em; ">
Open
</td>
</tr>
<tr>
<td style="text-align:left;">
FlatGeobuf
</td>
<td style="text-align:left;width: 5em; ">
.fgb
</td>
<td style="text-align:left;width: 12em; ">
Single file format allowing for quick reading and writing of vector data. Has streaming capabilities.
</td>
<td style="text-align:left;width: 4em; ">
Vector
</td>
<td style="text-align:left;width: 5em; ">
Open
</td>
</tr>
<tr>
<td style="text-align:left;">
GeoTIFF
</td>
<td style="text-align:left;width: 5em; ">
.tif/.tiff
</td>
<td style="text-align:left;width: 12em; ">
Popular raster format. A TIFF file containing additional spatial metadata.
</td>
<td style="text-align:left;width: 4em; ">
Raster
</td>
<td style="text-align:left;width: 5em; ">
Open
</td>
</tr>
<tr>
<td style="text-align:left;">
Arc ASCII
</td>
<td style="text-align:left;width: 5em; ">
.asc
</td>
<td style="text-align:left;width: 12em; ">
Text format where the first six lines represent the raster header, followed by the raster cell values arranged in rows and columns.
</td>
<td style="text-align:left;width: 4em; ">
Raster
</td>
<td style="text-align:left;width: 5em; ">
Open
</td>
</tr>
<tr>
<td style="text-align:left;">
SQLite/SpatiaLite
</td>
<td style="text-align:left;width: 5em; ">
.sqlite
</td>
<td style="text-align:left;width: 12em; ">
Standalone relational database, SpatiaLite is the spatial extension of SQLite.
</td>
<td style="text-align:left;width: 4em; ">
Vector and raster
</td>
<td style="text-align:left;width: 5em; ">
Open
</td>
</tr>
<tr>
<td style="text-align:left;">
ESRI FileGDB
</td>
<td style="text-align:left;width: 5em; ">
.gdb
</td>
<td style="text-align:left;width: 12em; ">
Spatial and non-spatial objects created by ArcGIS. Allows multiple feature classes; topology. Limited support from GDAL.
</td>
<td style="text-align:left;width: 4em; ">
Vector and raster
</td>
<td style="text-align:left;width: 5em; ">
Proprietary
</td>
</tr>
<tr>
<td style="text-align:left;">
GeoPackage
</td>
<td style="text-align:left;width: 5em; ">
.gpkg
</td>
<td style="text-align:left;width: 12em; ">
Lightweight database container based on SQLite allowing an easy and platform-independent exchange of geodata.
</td>
<td style="text-align:left;width: 4em; ">
Vector and (very limited) raster
</td>
<td style="text-align:left;width: 5em; ">
Open
</td>
</tr>
</tbody>
</table></div>
<p>
An important development ensuring the standardization and open-sourcing of file formats was the founding of the Open Geospatial Consortium (<a href="https://www.ogc.org/">OGC</a>) in 1994.
Beyond defining the simple features data model (see Section <a href="spatial-class.html#intro-sf">2.2.1</a>), the OGC also coordinates the development of open standards, for example as used in file formats such as GML, KML and GeoPackage.
Open file formats of the kind endorsed by the OGC have several advantages over proprietary formats: the standards are published, ensure transparency and open up the possibility for users to further develop and adjust the file formats to their specific needs.</p>
<p>ESRI Shapefile is the most popular vector data exchange format; however, it is not an open format (though its specification is open).
It was developed in the early 1990s and has a number of limitations.
First of all, it is a multi-file format, which consists of at least three files.
It only supports 255 columns, column names are restricted to ten characters and the file size limit is 2 GB.
Furthermore, ESRI Shapefile does not support all possible geometry types, for example, it is unable to distinguish between a polygon and a multipolygon.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;To learn more about ESRI Shapefile limitations and possible alternative file formats, visit &lt;a href="http://switchfromshapefile.org/" class="uri"&gt;http://switchfromshapefile.org/&lt;/a&gt;.&lt;/p&gt;'><sup>41</sup></a>
Despite these limitations, a viable alternative had been missing for a long time.
In recent years, <a href="https://www.geopackage.org/">GeoPackage</a> emerged, and seems to be a more than suitable replacement candidate for ESRI Shapefile.
Geopackage is a format for exchanging geospatial information and an OGC standard.
The GeoPackage standard describes the rules on how to store geospatial information in a tiny SQLite container.
Hence, GeoPackage is a lightweight spatial database container, which allows the storage of vector and raster data but also of non-spatial data and extensions.
Aside from GeoPackage, there are other geospatial data exchange formats worth checking out (Table <a href="read-write.html#tab:formats">8.1</a>).</p>
<p>
The GeoTIFF format seems to be the most prominent raster data format.
It allows spatial information, such as CRS, to be embedded within a TIFF file.
Similar to ESRI Shapefile, this format was first developed in the 1990s, but as an open format.
Additionally, GeoTIFF is still being expanded and improved.
One of the most significant recent additions to the GeoTIFF format is its variant called <a href="https://www.cogeo.org/">COG</a> (<em>Cloud Optimized GeoTIFF</em>).
Raster objects saved as COGs can be hosted on HTTP servers, so other people can read only parts of the file without downloading the whole file (see Sections <a href="read-write.html#raster-data-read">8.3.2</a> and <a href="read-write.html#raster-data-write">8.4.2</a>).</p>
<p>There are many geographic file formats beyond those shown in Table <a href="read-write.html#tab:formats">8.1</a> and new data formats capable of representing geographic are being developed.
Recent examples are formats based on the <a href="https://github.com/geoarrow/geoarrow">GeoArrow</a> and <a href="https://zarr.dev/">Zarr</a> specifications.
GDAL’s documentation provides a good resource for learning about other <a href="https://gdal.org/drivers/vector/index.html">vector</a> and <a href="https://gdal.org/drivers/raster/index.html">raster</a> drivers.
Furthermore, some data formats can store other data models (types) beyond the vector and raster data models introduced in Section <a href="spatial-class.html#intro-sf">2.2.1</a>.
It includes LAS and LAZ formats for storing lidar point clouds, and NetCDF and HDF for storing multidimensional arrays.</p>
<p>Spatial data is also often stored using tabular (non-spatial) text formats, including CSV files or Excel spreadsheets.
For example, this can be convenient to share spatial samples with people who do not use GIS tools or exchange data with other software that does not accept spatial data formats.
However, this approach has downsides: it is challenging for storing geometries that are more complex than POINTs and omits important spatial metadata such as the CRS.</p>
</div>
<div id="data-input" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Data input (I)<a class="anchor" aria-label="anchor" href="#data-input"><i class="fas fa-link"></i></a>
</h2>
<p>Executing commands such as <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">sf::read_sf()</a></code> (the main function we use for loading vector data) or <code><a href="https://rspatial.github.io/terra/reference/rast.html">terra::rast()</a></code> (the main function used for loading raster data) silently sets off a chain of events that reads data from files.
Many R packages provide example datasets (e.g., the dataset <code><a href="https://jakubnowosad.com/spData/reference/world.html">spData::world</a></code> that we used in earlier chapters) and functions to get geographic datasets from a range of data sources.
All of them load the data into R or, more precisely, assign objects to your workspace.
This means that when objects are imported into R they are stored in RAM<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;There are some exceptions to this rule, e.g., &lt;strong&gt;terra&lt;/strong&gt;’s &lt;code&gt;SpatRaster&lt;/code&gt; objects (which are C++ pointers to the actual data) and objects that represent database connections that can be imported into memory with functions such as &lt;code&gt;dplyr::collect()&lt;/code&gt;, as outlined in Section &lt;a href="gis.html#postgis"&gt;10.7&lt;/a&gt;.&lt;/p&gt;'><sup>42</sup></a>, can be listed with <code><a href="https://rdrr.io/r/base/ls.html">ls()</a></code> (and should be viewable in ‘Environment’ panels in your development environement) and can be accessed from the <a href="http://adv-r.had.co.nz/Environments.html"><code>.GlobalEnv</code></a> of the R session.</p>
<div id="iovec" class="section level3" number="8.3.1">
<h3>
<span class="header-section-number">8.3.1</span> Vector data<a class="anchor" aria-label="anchor" href="#iovec"><i class="fas fa-link"></i></a>
</h3>
<p>
Spatial vector data comes in a wide variety of file formats.
Most popular representations such as <code>.geojson</code> and <code>.gpkg</code> files can be imported directly into R with the <strong>sf</strong> function <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code> (or the equivalent <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read()</a></code>), which uses <a href="https://gdal.org/drivers/vector/index.html">GDAL’s vector drivers</a> behind the scenes.
The <code><a href="https://r-spatial.github.io/sf/reference/st_drivers.html">st_drivers()</a></code> function returns a data frame containing <code>name</code> and <code>long_name</code> in the first two columns, and features of each driver available to GDAL (and therefore <strong>sf</strong>), including ability to write data and store raster data in the subsequent columns, as illustrated for key file formats in Table <a href="read-write.html#tab:drivers">8.3</a>.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:drivers">TABLE 8.3: </span><span id="tab:drivers">TABLE 8.4: </span>Popular drivers/formats for reading/writing vector data.
</caption>
<thead><tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:left;">
long_name
</th>
<th style="text-align:left;">
write
</th>
<th style="text-align:left;">
copy
</th>
<th style="text-align:left;">
is_raster
</th>
<th style="text-align:left;">
is_vector
</th>
<th style="text-align:left;">
vsi
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
ESRI Shapefile
</td>
<td style="text-align:left;width: 7em; ">
ESRI Shapefile
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
GPX
</td>
<td style="text-align:left;width: 7em; ">
GPX
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
KML
</td>
<td style="text-align:left;width: 7em; ">
Keyhole Markup Language (KML)
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
GeoJSON
</td>
<td style="text-align:left;width: 7em; ">
GeoJSON
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
GPKG
</td>
<td style="text-align:left;width: 7em; ">
GeoPackage
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
FlatGeobuf
</td>
<td style="text-align:left;width: 7em; ">
FlatGeobuf
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
</tbody>
</table></div>
<p>The following commands show the first three drivers reported the computer’s GDAL installation (results can vary depending on the GDAL version installed) and a summary of their features.
Note that the majority of drivers can write data, while only a dozen or so formats can efficiently represent raster data in addition to vector data (see <code>?st_drivers()</code> for details):</p>
<div class="sourceCode" id="cb261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sf_drivers</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_drivers.html">st_drivers</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html">head</a></span><span class="op">(</span><span class="va">sf_drivers</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html">summary</a></span><span class="op">(</span><span class="va">sf_drivers</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The first argument of <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code> is <code>dsn</code>, which should be a text string or an object containing a single text string.
The content of a text string could vary between different drivers.
In most cases, as with the ESRI Shapefile (<code>.shp</code>) or the <code>GeoPackage</code> format (<code>.gpkg</code>), the <code>dsn</code> would be a file name.
<code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code> guesses the driver based on the file extension, as illustrated for a <code>.gpkg</code> file below:</p>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"shapes/world.gpkg"</span>, package <span class="op">=</span> <span class="st">"spData"</span><span class="op">)</span></span>
<span><span class="va">world</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span></code></pre></div>
<p>For some drivers, <code>dsn</code> could be provided as a folder name, access credentials for a database, or a GeoJSON string representation (see the examples of the <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code> help page for more details).</p>
<p>Some vector driver formats can store multiple data layers.
By default, <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code> automatically reads the first layer of the file specified in <code>dsn</code>; however, using the <code>layer</code> argument you can specify any other layer.</p>
<p>
The <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code> function also allows for reading just parts of the file into RAM with two possible mechanisms.
The first one is related to the <code>query</code> argument, which allows specifying what part of the data to read with <a href="https://gdal.org/user/ogr_sql_dialect.html">the OGR SQL query text</a>.
An example below extracts data for Tanzania only (Figure <a href="read-write.html#fig:readsfquery">8.1</a>A).
It is done by specifying that we want to get all columns (<code>SELECT *</code>) from the <code>"world"</code> layer for which the <code>name_long</code> is equal to <code>"Tanzania"</code>:</p>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tanzania</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="va">f</span>, query <span class="op">=</span> <span class="st">'SELECT * FROM world WHERE name_long = "Tanzania"'</span><span class="op">)</span></span></code></pre></div>
<p>If you do not know the names of the available columns, a good approach is to just read one row of the data with <code>'SELECT * FROM world WHERE FID = 1'</code>.
<code>FID</code> represents a <em>feature ID</em> – most often, it is a row number; however, its values depend on the used file format.
For example, <code>FID</code> starts from 0 in ESRI Shapefile, from 1 in some other file formats, or can be even arbitrary.</p>
<p>The second mechanism uses the <code>wkt_filter</code> argument.
This argument expects a well-known text representing a study area for which we want to extract the data.
Let’s try it using a small example – we want to read polygons from our file that intersect with the buffer of 50,000 meters of Tanzania’s borders.
To do it, we need to prepare our “filter” by (a) creating the buffer (Section <a href="geometry-operations.html#buffers">5.2.3</a>), (b) converting the <code>sf</code> buffer object into an <code>sfc</code> geometry object with <code><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry()</a></code>, and (c) translating geometries into their well-known text representation with <code><a href="https://r-spatial.github.io/sf/reference/st_as_text.html">st_as_text()</a></code>:</p>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tanzania_buf</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_buffer</a></span><span class="op">(</span><span class="va">tanzania</span>, <span class="fl">50000</span><span class="op">)</span></span>
<span><span class="va">tanzania_buf_geom</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">tanzania_buf</span><span class="op">)</span></span>
<span><span class="va">tanzania_buf_wkt</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_text.html">st_as_text</a></span><span class="op">(</span><span class="va">tanzania_buf_geom</span><span class="op">)</span></span></code></pre></div>
<p>Now, we can apply this “filter” using the <code>wkt_filter</code> argument.</p>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tanzania_neigh</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="va">f</span>, wkt_filter <span class="op">=</span> <span class="va">tanzania_buf_wkt</span><span class="op">)</span></span></code></pre></div>
<p>Our result, shown in Figure <a href="read-write.html#fig:readsfquery">8.1</a>(B), contains Tanzania and every country within its 50-km buffer.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:readsfquery"></span>
<img src="figures/readsfquery-1.png" alt="Reading a subset of the vector data using (A) a query and (B) a wkt filter." width="100%"><p class="caption">
FIGURE 8.1: Reading a subset of the vector data using (A) a query and (B) a wkt filter.
</p>
</div>
<p>Naturally, some options are specific to certain drivers.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;
A list of supported vector formats and options can be found at &lt;a href="https://gdal.org/ogr_formats.html" class="uri"&gt;https://gdal.org/ogr_formats.html&lt;/a&gt;.&lt;/p&gt;'><sup>43</sup></a>
For example, think of coordinates stored in a spreadsheet format (<code>.csv</code>).
To read-in such files as spatial objects, we naturally have to specify the names of the columns (<code>X</code> and <code>Y</code> in our example below) representing the coordinates.
We can do this with the help of the <code>options</code> parameter.
To find out about possible options, please refer to the ‘Open Options’ section of the corresponding GDAL driver description.
For the comma-separated value (csv) format, visit <a href="https://gdal.org/drv_csv.html" class="uri">https://gdal.org/drv_csv.html</a>.</p>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cycle_hire_txt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"misc/cycle_hire_xy.csv"</span>, package <span class="op">=</span> <span class="st">"spData"</span><span class="op">)</span></span>
<span><span class="va">cycle_hire_xy</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="va">cycle_hire_txt</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X_POSSIBLE_NAMES=X"</span>, <span class="st">"Y_POSSIBLE_NAMES=Y"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Instead of columns describing ‘XY’ coordinates, a single column can also contain the geometry information.
Well-known text (WKT), well-known binary (WKB), and the GeoJSON formats are examples of this.
For instance, the <code>world_wkt.csv</code> file has a column named <code>WKT</code> representing polygons of the world’s countries.
We will again use the <code>options</code> parameter to indicate this.</p>
<div class="sourceCode" id="cb267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world_txt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"misc/world_wkt.csv"</span>, package <span class="op">=</span> <span class="st">"spData"</span><span class="op">)</span></span>
<span><span class="va">world_wkt</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="va">world_txt</span>, options <span class="op">=</span> <span class="st">"GEOM_POSSIBLE_NAMES=WKT"</span><span class="op">)</span></span></code></pre></div>

<div class="rmdnote">
Not all of the supported vector file formats store information about their coordinate reference system.
In these situations, it is possible to add the missing information using the <code><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_set_crs()</a></code> function.
Please refer also to Section <a href="reproj-geo-data.html#crs-setting">7.3</a> for more information.
</div>
<p>
As a final example, we will show how <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code> also reads KML files.
A KML file stores geographic information in XML format, which is a data format for the creation of web pages and the transfer of data in an application-independent way <span class="citation">(<a href="references.html#ref-nolan_xml_2014">Nolan and Lang 2014</a>)</span>.
Here, we access a KML file from the web.
This file contains more than one layer.
<code><a href="https://r-spatial.github.io/sf/reference/st_layers.html">st_layers()</a></code> lists all available layers.
We choose the first layer <code>Placemarks</code> and say so with the help of the <code>layer</code> parameter in <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code>.</p>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">u</span> <span class="op">=</span> <span class="st">"https://developers.google.com/kml/documentation/KML_Samples.kml"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="va">u</span>, <span class="st">"KML_Samples.kml"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_layers.html">st_layers</a></span><span class="op">(</span><span class="st">"KML_Samples.kml"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Driver: LIBKML </span></span>
<span><span class="co">#&gt; Available layers:</span></span>
<span><span class="co">#&gt;               layer_name geometry_type features fields crs_name</span></span>
<span><span class="co">#&gt; 1             Placemarks                      3     11   WGS 84</span></span>
<span><span class="co">#&gt; 2      Styles and Markup                      1     11   WGS 84</span></span>
<span><span class="co">#&gt; 3       Highlighted Icon                      1     11   WGS 84</span></span>
<span><span class="va">....</span></span>
<span><span class="va">kml</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="st">"KML_Samples.kml"</span>, layer <span class="op">=</span> <span class="st">"Placemarks"</span><span class="op">)</span></span></code></pre></div>
<p>All the examples presented in this section so far have used the <strong>sf</strong> package for geographic data import.
It is fast and flexible, but it may be worth looking at other packages such as <strong>duckdb</strong>, an R interface to the DuckDB database system which has a <a href="https://duckdb.org/docs/extensions/spatial.html">spatial extension</a>.</p>
</div>
<div id="raster-data-read" class="section level3" number="8.3.2">
<h3>
<span class="header-section-number">8.3.2</span> Raster data<a class="anchor" aria-label="anchor" href="#raster-data-read"><i class="fas fa-link"></i></a>
</h3>
<p>
Similar to vector data, raster data comes in many file formats with some supporting multi-layer files.
<strong>terra</strong>’s <code><a href="https://rspatial.github.io/terra/reference/rast.html">rast()</a></code> command reads in a single layer when a file with just one layer is provided.</p>
<div class="sourceCode" id="cb269"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raster_filepath</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"raster/srtm.tif"</span>, package <span class="op">=</span> <span class="st">"spDataLarge"</span><span class="op">)</span></span>
<span><span class="va">single_layer</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html">rast</a></span><span class="op">(</span><span class="va">raster_filepath</span><span class="op">)</span></span></code></pre></div>
<p>It also works in case you want to read a multi-layer file.</p>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multilayer_filepath</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"raster/landsat.tif"</span>, package <span class="op">=</span> <span class="st">"spDataLarge"</span><span class="op">)</span></span>
<span><span class="va">multilayer_rast</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html">rast</a></span><span class="op">(</span><span class="va">multilayer_filepath</span><span class="op">)</span></span></code></pre></div>
<p>
All of the previous examples read spatial information from files stored on your hard drive.
However, GDAL also allows reading data directly from online resources, such as HTTP/HTTPS/FTP web resources.
The only thing we need to do is to add a <code>/vsicurl/</code> prefix before the path to the file.
Let’s try it by connecting to the global monthly snow probability at 500-m resolution for the period 2000-2012.
Snow probability for December is stored as a Cloud Optimized GeoTIFF (COG) file (see Section <a href="read-write.html#file-formats">8.2</a>) at <a href="https://zenodo.org/record/5774954/files/clm_snow.prob_esacci.dec_p.90_500m_s0..0cm_2000..2012_v2.0.tif">zenodo.org</a>.
To read an online file, we just need to provide its URL together with the <code>/vsicurl/</code> prefix.</p>
<div class="sourceCode" id="cb271"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myurl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"/vsicurl/https://zenodo.org/record/5774954/files/"</span>,</span>
<span>               <span class="st">"clm_snow.prob_esacci.dec_p.90_500m_s0..0cm_2000..2012_v2.0.tif"</span><span class="op">)</span></span>
<span><span class="va">snow</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html">rast</a></span><span class="op">(</span><span class="va">myurl</span><span class="op">)</span></span>
<span><span class="va">snow</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; size        : 35849, 86400, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 0.00417, 0.00417  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -180, 180, -62, 87.4  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">#&gt; source      : clm_snow.prob_esacci.dec_p.90_500m_s0..0cm_2000..2012_v2.0.tif </span></span>
<span><span class="co">#&gt; name        : clm_snow.prob_esacci.dec_p.90_500m_s0..0cm_2000..2012_v2.0</span></span></code></pre></div>
<p>
Due to the fact that the input data is COG, we are actually not reading this file to our RAM, but rather creating a connection to it without obtaining any values.
Its values will be read if we apply any value-based operation (e.g., <code><a href="https://rspatial.github.io/terra/reference/crop.html">crop()</a></code> or <code><a href="https://rspatial.github.io/terra/reference/extract.html">extract()</a></code>).
This allows us also to just read a tiny portion of the data without downloading the entire file.
For example, we can get the snow probability for December in Reykjavik (70%) by specifying its coordinates and applying the <code><a href="https://rspatial.github.io/terra/reference/extract.html">extract()</a></code> function:</p>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rey</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="op">-</span><span class="fl">21.94</span>, lat <span class="op">=</span> <span class="fl">64.15</span><span class="op">)</span></span>
<span><span class="va">snow_rey</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html">extract</a></span><span class="op">(</span><span class="va">snow</span>, <span class="va">rey</span><span class="op">)</span></span>
<span><span class="va">snow_rey</span></span>
<span><span class="co">#&gt;   ID clm_snow.prob_esacci.dec_p.90_500m_s0..0cm_2000..2012_v2.0</span></span>
<span><span class="co">#&gt; 1  1                                                         70</span></span></code></pre></div>
<p>This way, we just downloaded a single value instead of the whole, large GeoTIFF file.
The above example just shows one simple (but useful) case, but there is more to explore.
The <code>/vsicurl/</code> prefix also works not only for raster but also for vector file formats.
It allows reading vectors directly from online storage with <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code> just by adding the prefix before the vector file URL.</p>
<p>Importantly, <code>/vsicurl/</code> is not the only prefix provided by GDAL – many more exist, such as <code>/vsizip/</code> to read spatial files from ZIP archives without decompressing them beforehand or <code>/vsis3/</code> for on-the-fly reading files available in AWS S3 buckets.
You can learn more about it at <a href="https://gdal.org/user/virtual_file_systems.html" class="uri">https://gdal.org/user/virtual_file_systems.html</a>.</p>
<p>As with vector data, raster datasets can also be stored in and read from some spatial databases, notably PostGIS.
See Section <a href="gis.html#postgis">10.7</a> for more details.</p>
</div>
</div>
<div id="data-output" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Data output (O)<a class="anchor" aria-label="anchor" href="#data-output"><i class="fas fa-link"></i></a>
</h2>
<p>Writing geographic data allows you to convert from one format to another and to save newly created objects.
Depending on the data type (vector or raster), object class (e.g., <code>sf</code> or <code>SpatRaster</code>), and type and amount of stored information (e.g., object size, range of values), it is important to know how to store spatial files in the most efficient way.
The next two sections will demonstrate how to do this.</p>
<div id="vector-data-1" class="section level3" number="8.4.1">
<h3>
<span class="header-section-number">8.4.1</span> Vector data<a class="anchor" aria-label="anchor" href="#vector-data-1"><i class="fas fa-link"></i></a>
</h3>
<p></p>
<p>The counterpart of <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code> is <code><a href="https://r-spatial.github.io/sf/reference/st_write.html">write_sf()</a></code>.
It allows you to write <strong>sf</strong> objects to a wide range of geographic vector file formats, including the most common such as <code>.geojson</code>, <code>.shp</code> and <code>.gpkg</code>.
Based on the file name, <code><a href="https://r-spatial.github.io/sf/reference/st_write.html">write_sf()</a></code> decides automatically which driver to use.
The speed of the writing process depends also on the driver.</p>
<div class="sourceCode" id="cb273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html">write_sf</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">world</span>, dsn <span class="op">=</span> <span class="st">"world.gpkg"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Note</strong>: if you try to write to the same data source again, the function will overwrite the file:</p>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html">write_sf</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">world</span>, dsn <span class="op">=</span> <span class="st">"world.gpkg"</span><span class="op">)</span></span></code></pre></div>
<p>Instead of overwriting the file, we could add a new layer to the file by specifying the <code>layer</code> argument.
This is supported by several spatial formats, including GeoPackage.</p>
<div class="sourceCode" id="cb275"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html">write_sf</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">world</span>, dsn <span class="op">=</span> <span class="st">"world_many_layers.gpkg"</span>, layer <span class="op">=</span> <span class="st">"second_layer"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, you can use <code><a href="https://r-spatial.github.io/sf/reference/st_write.html">st_write()</a></code> since it is equivalent to <code><a href="https://r-spatial.github.io/sf/reference/st_write.html">write_sf()</a></code>.
However, it has different defaults – it does not overwrite files (returns an error when you try to do it) and shows a short summary of the written file format and the object.</p>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html">st_write</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">world</span>, dsn <span class="op">=</span> <span class="st">"world2.gpkg"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Writing layer `world2' to data source `world2.gpkg' using driver `GPKG'</span></span>
<span><span class="co">#&gt; Writing 177 features with 10 fields and geometry type Multi Polygon.</span></span></code></pre></div>
<p>The <code>layer_options</code> argument could be also used for many different purposes.
One of them is to write spatial data to a text file.
This can be done by specifying <code>GEOMETRY</code> inside of <code>layer_options</code>.
It could be either <code>AS_XY</code> for simple point datasets (it creates two new columns for coordinates) or <code>AS_WKT</code> for more complex spatial data (one new column is created which contains the well-known text representation of spatial objects).</p>
<div class="sourceCode" id="cb277"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html">write_sf</a></span><span class="op">(</span><span class="va">cycle_hire_xy</span>, <span class="st">"cycle_hire_xy.csv"</span>, layer_options <span class="op">=</span> <span class="st">"GEOMETRY=AS_XY"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html">write_sf</a></span><span class="op">(</span><span class="va">world_wkt</span>, <span class="st">"world_wkt.csv"</span>, layer_options <span class="op">=</span> <span class="st">"GEOMETRY=AS_WKT"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="raster-data-write" class="section level3" number="8.4.2">
<h3>
<span class="header-section-number">8.4.2</span> Raster data<a class="anchor" aria-label="anchor" href="#raster-data-write"><i class="fas fa-link"></i></a>
</h3>
<p>
The <code><a href="https://rspatial.github.io/terra/reference/writeRaster.html">writeRaster()</a></code> function saves <code>SpatRaster</code> objects to files on disk.
The function expects input regarding output data type and file format, but also accepts GDAL options specific to a selected file format (see <code><a href="https://rspatial.github.io/terra/reference/writeRaster.html">?writeRaster</a></code> for more details).</p>
<p>
The <strong>terra</strong> package offers seven data types when saving a raster: INT1U, INT2S, INT2U, INT4S, INT4U, FLT4S, and FLT8S,<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;
Using INT4U is not recommended, as R does not support 32-bit unsigned integers.&lt;/p&gt;"><sup>44</sup></a> which determine the bit representation of the raster object written to disk (Table <a href="read-write.html#tab:datatypes">8.5</a>).
Which data type to use depends on the range of the values of your raster object.
The more values a data type can represent, the larger the file will get on disk.
Unsigned integers (INT1U, INT2U, INT4U) are suitable for categorical data, while float numbers (FLT4S and FLT8S) usually represent continuous data.
<code><a href="https://rspatial.github.io/terra/reference/writeRaster.html">writeRaster()</a></code> uses FLT4S as the default.
While this works in most cases, the size of the output file will be unnecessarily large if you save binary or categorical data.
Therefore, we would recommend to use the data type that needs the least storage space but is still able to represent all values (check the range of values with the <code><a href="https://rspatial.github.io/terra/reference/summary.html">summary()</a></code> function).</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:datatypes">TABLE 8.5: </span>Data types supported by the terra package.</caption>
<thead><tr class="header">
<th align="left">Data Type</th>
<th align="left">Minimum Value</th>
<th align="left">Maximum Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">INT1U</td>
<td align="left">0</td>
<td align="left">255</td>
</tr>
<tr class="even">
<td align="left">INT2S</td>
<td align="left">–32,767</td>
<td align="left">32,767</td>
</tr>
<tr class="odd">
<td align="left">INT2U</td>
<td align="left">0</td>
<td align="left">65,534</td>
</tr>
<tr class="even">
<td align="left">INT4S</td>
<td align="left">–2,147,483,647</td>
<td align="left">2,147,483,647</td>
</tr>
<tr class="odd">
<td align="left">INT4U</td>
<td align="left">0</td>
<td align="left">4,294,967,296</td>
</tr>
<tr class="even">
<td align="left">FLT4S</td>
<td align="left">–3.4e+38</td>
<td align="left">3.4e+38</td>
</tr>
<tr class="odd">
<td align="left">FLT8S</td>
<td align="left">–1.7e+308</td>
<td align="left">1.7e+308</td>
</tr>
</tbody>
</table></div>
<p>By default, the output file format is derived from the filename.
Naming a file <code>*.tif</code> will create a GeoTIFF file, as demonstrated below:</p>
<div class="sourceCode" id="cb278"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html">writeRaster</a></span><span class="op">(</span><span class="va">single_layer</span>, filename <span class="op">=</span> <span class="st">"my_raster.tif"</span>, datatype <span class="op">=</span> <span class="st">"INT2U"</span><span class="op">)</span></span></code></pre></div>
<p>Some raster file formats have additional options that can be set by providing <a href="https://gdal.org/formats_list.html">GDAL parameters</a> to the <code>options</code> argument of <code><a href="https://rspatial.github.io/terra/reference/writeRaster.html">writeRaster()</a></code>.
GeoTIFF files are written in <strong>terra</strong>, by default, with the LZW compression <code>gdal = c("COMPRESS=LZW")</code>.
To change or disable the compression, we need to modify this argument.</p>
<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html">writeRaster</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">single_layer</span>, filename <span class="op">=</span> <span class="st">"my_raster.tif"</span>,</span>
<span>            gdal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COMPRESS=NONE"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>
Additionally, we can save our raster object as COG (Cloud Optimized GeoTIFF, Section <a href="read-write.html#file-formats">8.2</a>) with the <code>filetype = "COG"</code> options.</p>
<div class="sourceCode" id="cb280"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html">writeRaster</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">single_layer</span>, filename <span class="op">=</span> <span class="st">"my_raster.tif"</span>,</span>
<span>            filetype <span class="op">=</span> <span class="st">"COG"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>To learn more about the compression of GeoTIFF files, we recommend Paul Ramsey’s <a href="https://blog.cleverelephant.ca/2015/02/geotiff-compression-for-dummies.html">comprehensive blog post, GeoTiff Compression for Dummies</a> which can be found online.</p>
</div>
</div>
<div id="retrieving-data" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Geoportals<a class="anchor" aria-label="anchor" href="#retrieving-data"><i class="fas fa-link"></i></a>
</h2>
<p>
A vast and ever-increasing amount of geographic data is available on the internet, much of which is free to access and use (with appropriate credit given to its providers).<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;For example, visit &lt;a href="https://freegisdata.rtwilson.com/"&gt;freegisdata.rtwilson.com&lt;/a&gt; for a long list of websites with freely available geographic datasets.&lt;/p&gt;'><sup>45</sup></a>
In some ways there is now <em>too much</em> data, in the sense that there are often multiple places to access the same dataset.
Some datasets are of poor quality.
In this context, it is vital to know where to look, so the first section covers some of the most important sources.
Various ‘geoportals’ (web services providing geospatial datasets such as <a href="https://catalog.data.gov/dataset?metadata_type=geospatial">Data.gov</a>) are a good place to start, providing a wide range of data but often only for specific locations (as illustrated in the updated <a href="https://en.wikipedia.org/wiki/Geoportal">Wikipedia page</a> on the topic).</p>
<p>
Some global geoportals overcome this issue.
The <a href="https://www.geoportal.org/">GEOSS portal</a> and the <a href="https://dataspace.copernicus.eu/">Copernicus Data Space Ecosystem</a>, for example, contain many raster datasets with global coverage.
A wealth of vector datasets can be accessed from the <a href="https://sedac.ciesin.columbia.edu/">SEDAC</a> portal run by the National Aeronautics and Space Administration (NASA) and the European Union’s <a href="http://inspire-geoportal.ec.europa.eu/">INSPIRE geoportal</a>, with global and regional coverage.</p>
<p>Most geoportals provide a graphical interface allowing datasets to be queried based on characteristics such as spatial and temporal extent, the United States Geological Survey’s <a href="https://earthexplorer.usgs.gov/">EarthExplorer</a> being a prime example.
<em>Exploring</em> datasets interactively on a browser is an effective way of understanding available layers.
<em>Downloading</em> data is best done with code, however, from reproducibility and efficiency perspectives.
Downloads can be initiated from the command line using a variety of techniques, primarily via URLs and APIs (see the <a href="https://dataspace.copernicus.eu/analyse/apis">Copernicus APIs</a> for example).<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;An example of using a STAC-API to download Sentinel-2 data is provided in Section &lt;a href="gis.html#staccog"&gt;10.8.1&lt;/a&gt;.&lt;/p&gt;'><sup>46</sup></a>
Files hosted on static URLs can be downloaded with <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code>, as illustrated in the code chunk below which accesses PeRL: Permafrost Region Pond and Lake Database from <a href="https://doi.pangaea.de/10.1594/PANGAEA.868349">pangaea.de</a>:</p>
<div class="sourceCode" id="cb281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://hs.pangaea.de/Maps/PeRL/PeRL_permafrost_landscapes.zip"</span>,</span>
<span>              destfile <span class="op">=</span> <span class="st">"PeRL_permafrost_landscapes.zip"</span>, </span>
<span>              mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span><span class="st">"PeRL_permafrost_landscapes.zip"</span><span class="op">)</span></span>
<span><span class="va">canada_perma_land</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="st">"PeRL_permafrost_landscapes/canada_perma_land.shp"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="geographic-data-packages" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> Geographic data packages<a class="anchor" aria-label="anchor" href="#geographic-data-packages"><i class="fas fa-link"></i></a>
</h2>
<p>
Many R packages have been developed for accessing geographic data, some of which are presented in Table <a href="read-write.html#tab:datapackages">8.6</a>.
These provide interfaces to one or more spatial libraries or geoportals and aim to make data access even quicker from the command line.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:datapackages">TABLE 8.6: </span><span id="tab:datapackages">TABLE 8.7: </span>Selected R packages for geographic data retrieval.
</caption>
<thead><tr>
<th style="text-align:left;">
Package
</th>
<th style="text-align:left;">
Description
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;width: 5em; ">
climateR
</td>
<td style="text-align:left;width: 22em; ">
Access over 100,000 gridded climate and landscape datasets from over 2,000 data providers by area of interest.
</td>
</tr>
<tr>
<td style="text-align:left;width: 5em; ">
elevatr
</td>
<td style="text-align:left;width: 22em; ">
Access point and raster elevation data from various sources.
</td>
</tr>
<tr>
<td style="text-align:left;width: 5em; ">
FedData
</td>
<td style="text-align:left;width: 22em; ">
Datasets maintained by the US federal government, including elevation and land cover.
</td>
</tr>
<tr>
<td style="text-align:left;width: 5em; ">
geodata
</td>
<td style="text-align:left;width: 22em; ">
Download and import imports administrative, elevation, WorldClim data.
</td>
</tr>
<tr>
<td style="text-align:left;width: 5em; ">
osmdata
</td>
<td style="text-align:left;width: 22em; ">
Download and import small OpenStreetMap datasets.
</td>
</tr>
<tr>
<td style="text-align:left;width: 5em; ">
osmextract
</td>
<td style="text-align:left;width: 22em; ">
Download and import large OpenStreetMap datasets.
</td>
</tr>
<tr>
<td style="text-align:left;width: 5em; ">
rnaturalearth
</td>
<td style="text-align:left;width: 22em; ">
Access Natural Earth vector and raster data.
</td>
</tr>
<tr>
<td style="text-align:left;width: 5em; ">
rnoaa
</td>
<td style="text-align:left;width: 22em; ">
Import National Oceanic and Atmospheric Administration (NOAA) climate data.
</td>
</tr>
</tbody>
</table></div>
<!-- other options: --><!-- https://github.com/ErikKusch/KrigR --><!-- https://github.com/VeruGHub/easyclimate --><!-- https://github.com/ropensci/MODIStsp --><!-- https://github.com/ropensci/rsat --><!-- https://onlinelibrary.wiley.com/doi/10.1111/ecog.06768--><p>It should be emphasized that Table <a href="read-write.html#tab:datapackages">8.6</a> represents only a small number of available geographic data packages.
For example, a large number of R packages exist to obtain various socio-demographic data, such as <strong>tidycensus</strong> and <strong>tigris</strong> (USA), <strong>cancensus</strong> (Canada), <strong>eurostat</strong> and <strong>giscoR</strong> (European Union), or <strong>idbr</strong> (international databases) – read <a href="https://walker-data.com/census-r/">Analyzing US Census Data</a> <span class="citation">(<a href="references.html#ref-walker_analyzing_2022">K. E. Walker 2022</a>)</span> to find some examples of how to analyze such data.
Similarly, several R packages exist giving access to spatial data for various regions and countries, such as <strong>bcdata</strong> (Province of British Columbia), <strong>geobr</strong> (Brazil), <strong>RCzechia</strong> (Czech Republic), or <strong>rgugik</strong> (Poland).</p>
<p>Each data package has its own syntax for accessing data.
This diversity is demonstrated in the subsequent code chunks, which show how to get data using three packages from Table <a href="read-write.html#tab:datapackages">8.6</a>.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;More examples of data downloading using dedicated R packages can be found at &lt;a href="https://rspatialdata.github.io/" class="uri"&gt;https://rspatialdata.github.io/&lt;/a&gt;.&lt;/p&gt;'><sup>47</sup></a>
Country borders are often useful and these can be accessed with the <code><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html">ne_countries()</a></code> function from the <strong>rnaturalearth</strong> package <span class="citation">(<a href="references.html#ref-R-rnaturalearth">Massicotte and South 2023</a>)</span> as follows:</p>
<div class="sourceCode" id="cb282"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/">rnaturalearth</a></span><span class="op">)</span></span>
<span><span class="va">usa_sf</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html">ne_countries</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"United States of America"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span></code></pre></div>
<p>Country borders can be also accessed with other packages, such as <strong>geodata</strong>, <strong>giscoR</strong>, or <strong>rgeoboundaries</strong>.</p>
<p>A second example downloads a series of rasters containing global monthly precipitation sums with spatial resolution of 10 minutes (~18.5 km at the equator) using the <strong>geodata</strong> package <span class="citation">(<a href="references.html#ref-R-geodata">Hijmans 2023a</a>)</span>.
The result is a multi-layer object of class <code>SpatRaster</code>.</p>
<div class="sourceCode" id="cb283"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">geodata</span><span class="op">)</span></span>
<span><span class="va">worldclim_prec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/geodata/man/worldclim.html">worldclim_global</a></span><span class="op">(</span><span class="st">"prec"</span>, res <span class="op">=</span> <span class="fl">10</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">worldclim_prec</span><span class="op">)</span></span></code></pre></div>
<p>A third example uses the <strong>osmdata</strong> package <span class="citation">(<a href="references.html#ref-R-osmdata">Padgham et al. 2023</a>)</span> to find parks from the OpenStreetMap (OSM) database.
As illustrated in the code-chunk below, queries begin with the function <code><a href="https://docs.ropensci.org/osmdata/reference/opq.html">opq()</a></code> (short for OpenStreetMap query), the first argument of which is a bounding box, or text string representing a bounding box (the city of Leeds, in this case).
The result is passed to a function for selecting which OSM elements we’re interested in (parks in this case), represented by <em>key-value pairs</em>.
Next, they are passed to the function <code><a href="https://docs.ropensci.org/osmdata/reference/osmdata_sf.html">osmdata_sf()</a></code> which does the work of downloading the data and converting it into a list of <code>sf</code> objects (see <code><a href="https://docs.ropensci.org/osmdata/articles/osmdata.html">vignette('osmdata')</a></code> for further details):</p>
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osmdata/">osmdata</a></span><span class="op">)</span></span>
<span><span class="va">parks</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="st">"leeds uk"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"leisure"</span>, value <span class="op">=</span> <span class="st">"park"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>A limitation with the <strong>osmdata</strong> package is that it is <em>rate-limited</em>, meaning that it cannot download large OSM datasets (e.g., all the OSM data for a large city).
To overcome this limitation, the <strong>osmextract</strong> package was developed, which can be used to download and import binary <code>.pbf</code> files containing compressed versions of the OSM database for predefined regions.</p>
<p>OpenStreetMap is a vast global database of crowd-sourced data, is growing daily, and has a wider ecosystem of tools enabling easy access to the data, from the <a href="https://overpass-turbo.eu/">Overpass turbo</a> web service for rapid development and testing of OSM queries to <a href="https://osm2pgsql.org/">osm2pgsql</a> for importing the data into a PostGIS database.
Although the quality of datasets derived from OSM varies, the data source and wider OSM ecosystems have many advantages: they provide datasets that are available globally, free of charge, and constantly improving thanks to an army of volunteers.
Using OSM encourages ‘citizen science’ and contributions back to the digital commons (you can start editing data representing a part of the world you know well at <a href="https://www.openstreetmap.org">www.openstreetmap.org</a>).
Further examples of OSM data in action are provided in Chapters <a href="gis.html#gis">10</a>, <a href="transport.html#transport">13</a> and <a href="location.html#location">14</a>.</p>
<!-- system.time({zion_lc = climateR::getNLCD(zion, year = 2019)}) -->
<p>Sometimes, packages come with built-in datasets.
These can be accessed in four ways: by attaching the package (if the package uses ‘lazy loading’ as <strong>spData</strong> does), with <code>data(dataset, package = mypackage)</code>, by referring to the dataset with <code>mypackage::dataset</code>, or with <code>system.file(filepath, package = mypackage)</code> to access raw data files.
The following code chunk illustrates the latter two options using the <code>world</code> dataset (already loaded by attaching its parent package with <code><a href="https://jakubnowosad.com/spData/">library(spData)</a></code>):<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;
For more information on data import with R packages, see Sections 5.5 and 5.6 of &lt;span class="citation"&gt;Gillespie and Lovelace (&lt;a href="references.html#ref-gillespie_efficient_2016"&gt;2016&lt;/a&gt;)&lt;/span&gt;.&lt;/p&gt;'><sup>48</sup></a></p>
<div class="sourceCode" id="cb285"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world2</span> <span class="op">=</span> <span class="fu">spData</span><span class="fu">::</span><span class="va"><a href="https://jakubnowosad.com/spData/reference/world.html">world</a></span></span>
<span><span class="va">world3</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"shapes/world.gpkg"</span>, package <span class="op">=</span> <span class="st">"spData"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The last example, <code>system.file("shapes/world.gpkg", package = "spData")</code>, returns a path to the <code>world.gpkg</code> file, which is stored inside of the <code>"shapes/"</code> folder of the <strong>spData</strong> package.</p>
<p>
Another way to obtain spatial information is to perform geocoding – transform a description of a location, usually an address, into its coordinates.
This is usually done by sending a query to an online service and getting the location as a result.
Many such services exist that differ in the used method of geocoding, usage limitations, costs, or application programming interface (API) key requirements.
R has several packages for geocoding; however, <strong>tidygeocoder</strong> seems to allow to connect to <a href="https://jessecambon.github.io/tidygeocoder/articles/geocoder_services.html">the largest number of geocoding services</a> with a consistent interface.
The <strong>tidygeocoder</strong> main function is <code>geocode</code>, which takes a data frame with addresses and adds coordinates as <code>"lat"</code> and <code>"long"</code>.
This function also allows to select a geocoding service with the <code>method</code> argument and has many additional parameters.</p>
<p>Let’s try this package by searching for coordinates of the John Snow blue plaque located on a building in the Soho district of London.</p>
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jessecambon.github.io/tidygeocoder/">tidygeocoder</a></span><span class="op">)</span></span>
<span><span class="va">geo_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>address <span class="op">=</span> <span class="st">"54 Frith St, London W1D 4SJ, UK"</span><span class="op">)</span></span>
<span><span class="va">geo_df</span> <span class="op">=</span> <span class="fu"><a href="https://jessecambon.github.io/tidygeocoder/reference/geocode.html">geocode</a></span><span class="op">(</span><span class="va">geo_df</span>, <span class="va">address</span>, method <span class="op">=</span> <span class="st">"osm"</span><span class="op">)</span></span>
<span><span class="va">geo_df</span></span></code></pre></div>
<p>The resulting data frame can be converted into an <code>sf</code> object with <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf()</a></code>.</p>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">geo_sf</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">geo_df</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"long"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span></span></code></pre></div>
<p><strong>tidygeocoder</strong> also allows performing the opposite process called reverse geocoding used to get a set of information (name, address, etc.) based on a pair of coordinates.
Geographic data can also be imported into R from various ‘bridges’ to geographic software, as described in Chapter <a href="gis.html#gis">10</a>.</p>
</div>
<div id="geographic-metadata" class="section level2" number="8.7">
<h2>
<span class="header-section-number">8.7</span> Geographic metadata<a class="anchor" aria-label="anchor" href="#geographic-metadata"><i class="fas fa-link"></i></a>
</h2>
<p>Geographic metadata are a cornerstone of geographic information management, used to describe datasets, data structures and services.
They help make datasets FAIR (Findable, Accessible, Interoperable, Reusable) and are defined by the ISO/OGC standards, in particular the ISO 19115 standard and underlying schemas.
These standards are widely used within spatial data infrastructures, handled through metadata catalogs.</p>
<p>Geographic metadata can be managed with <strong>geometa</strong>, a package that allows writing, reading and validating geographic metadata according to the ISO/OGC standards.
It already supports various international standards for geographic metadata information, such as the ISO 19110 (feature catalogue), legacy ISO 19115-1 and 19115-2 (geographic metadata for vector and gridded/imagery datasets), ISO 19115-3, ISO 19119 (geographic metadata for service), and ISO 19136 (Geographic Markup Language) providing methods to read, validate and write geographic metadata from R using the ISO/TS 19139 (XML) and ISO 19115-3 technical specifications.
<!-- To address the complexity and exhaustiveness the standards, and the advanced knowledge required to use them, complementary packages such as [**geoflow**](https://github.com/r-geoflow/geoflow) have been built to ease and automate the management of metadata. -->
Geographic metadata can be created with <strong>geometa</strong> as follows, which creates and saves a metadata file:</p>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eblondel/geometa/wiki">geometa</a></span><span class="op">)</span></span>
<span><span class="co"># create a metadata</span></span>
<span><span class="va">md</span> <span class="op">=</span> <span class="va">ISOMetadata</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#... fill the metadata 'md' object</span></span>
<span><span class="co"># validate metadata</span></span>
<span><span class="va">md</span><span class="op">$</span><span class="fu">validate</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># XML representation of the ISOMetadata</span></span>
<span><span class="va">xml</span> <span class="op">=</span> <span class="va">md</span><span class="op">$</span><span class="fu">encode</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># save metadata</span></span>
<span><span class="va">md</span><span class="op">$</span><span class="fu">save</span><span class="op">(</span><span class="st">"my_metadata.xml"</span><span class="op">)</span></span>
<span><span class="co"># read a metadata from an XML file</span></span>
<span><span class="va">md</span> <span class="op">=</span> <span class="fu">readISO19139</span><span class="op">(</span><span class="st">"my_metadata.xml"</span><span class="op">)</span></span></code></pre></div>
<p>The package comes with more <a href="https://github.com/eblondel/geometa/tree/master/inst/extdata/examples">examples</a> and has been extended by packages such as <strong><a href="https://github.com/r-geoflow/geoflow">geoflow</a></strong> to ease and automate the management of metadata.</p>
<p>In the field of standard geographic information management, the distinction between data and metadata is less clear.
The Geography Markup Language (GML) standard and file format covers both data and metadata, for example.
The <strong>geometa</strong> package allows exporting GML (ISO 19136) objects from geometry objects modeled with <strong>sf</strong>.
Such functionality allows use of geographic metadata (enabling the inclusion of metadata on detailed geographic and temporal extents, rather than simple bounding boxes, for example) and the provision of services that extend the GML standard (e.g., Open Geospatial Consortium Web Coverage Service, OGC-WCS).</p>
</div>
<div id="geographic-web-services" class="section level2" number="8.8">
<h2>
<span class="header-section-number">8.8</span> Geographic web services<a class="anchor" aria-label="anchor" href="#geographic-web-services"><i class="fas fa-link"></i></a>
</h2>
<p>
In an effort to standardize web APIs for accessing spatial data, the Open Geospatial Consortium (OGC) has created a number of standard specifications for web services (collectively known as OWS, which is short for OGC Web Services).
These services complement and use core standards developed to model geographic information, such as the <a href="https://www.iso.org/standard/66175.html">ISO/OGC Spatial Schema (ISO 19107:2019)</a>, or the <a href="https://www.iso.org/standard/40114.html">Simple Features (ISO 19125-1:2004)</a>, and to format data, such as with the <a href="https://www.iso.org/standard/75676.html">Geographic Markup Language (GML)</a>.
These specifications cover common access services for data and metadata.
Vector data can be accessed with the Web Feature Service (WFS), whereas grid/imagery can be accessed with the Web Coverage Service (WCS).
Map image representations, such as tiles, can be accessed with the Web Map Service (WMS) or the Web Map Tile Service (WMTS).
Metadata is also covered by means of the Catalogue Service for the Web (CSW).
Finally, standard processing is handled through the Web Processing Service (WPS) or the the Web Coverage Processing Service (WCPS).</p>
<p>Various open-source projects have adopted these protocols, such as <a href="https://geoserver.org/">GeoServer</a> and <a href="https://mapserver.org/">MapServer</a> for data-handling, or <a href="https://geonetwork-opensource.org/">GeoNetwork</a> and <a href="https://pycsw.org/">PyCSW</a> for metadata-handling, leading to standardization of queries.
Integrated tools for Spatial Data Infrastructures (SDI), such as <a href="https://geonode.org/">GeoNode</a>, <a href="https://www.georchestra.org/">GeOrchestra</a> or <a href="https://www.examind.com/">Examind</a> have also adopted these standard webservices, either directly or by using previously mentioned open-source tools.</p>
<p>Like other web APIs, OWS APIs use a ‘base URL’, an ‘endpoint’ and ‘URL query arguments’ following a <code>?</code> to request data (see the <a href="https://httr.r-lib.org/articles/api-packages.html"><code>best-practices-api-packages</code></a> vignette in the <strong>httr</strong> package).</p>
<p>There are many requests that can be made to a OWS service. Below examples illustrate how some requests can be made directly with <strong>httr</strong> or more straightforward with the <strong>ows4R</strong> package (OGC Web-Services for R).</p>
<p>Let’s start with examples using the <strong>httr</strong> package, which can be useful for understanding how web services work.
One of the most fundamental requests is <code>getCapabilities</code>, demonstrated with <strong>httr</strong> functions <code><a href="https://httr.r-lib.org/reference/GET.html">GET()</a></code> and <code><a href="https://httr.r-lib.org/reference/modify_url.html">modify_url()</a></code> below.
The following code chunk demonstrates how API queries can be constructed and dispatched, in this case to discover the capabilities of a service run by the Fisheries and Aquaculture Division of the Food and Agriculture Organization of the United Nations (UN-FAO).</p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://httr.r-lib.org/">httr</a></span><span class="op">)</span></span>
<span><span class="va">base_url</span> <span class="op">=</span> <span class="st">"https://www.fao.org"</span></span>
<span><span class="va">endpoint</span> <span class="op">=</span> <span class="st">"/fishery/geoserver/wfs"</span></span>
<span><span class="va">q</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>request <span class="op">=</span> <span class="st">"GetCapabilities"</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://httr.r-lib.org/reference/GET.html">GET</a></span><span class="op">(</span>url <span class="op">=</span> <span class="fu"><a href="https://httr.r-lib.org/reference/modify_url.html">modify_url</a></span><span class="op">(</span><span class="va">base_url</span>, path <span class="op">=</span> <span class="va">endpoint</span><span class="op">)</span>, query <span class="op">=</span> <span class="va">q</span><span class="op">)</span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">url</span></span>
<span><span class="co">#&gt; [1] "https://www.fao.org/fishery/geoserver/wfs?request=GetCapabilities"</span></span></code></pre></div>
<p>The above code chunk demonstrates how API requests can be constructed programmatically with the <code><a href="https://httr.r-lib.org/reference/GET.html">GET()</a></code> function, which takes a base URL and a list of query parameters that can easily be extended.
The result of the request is saved in <code>res</code>, an object of class <code>response</code> defined in the <strong>httr</strong> package, which is a list containing information of the request, including the URL.
As can be seen by executing <code>browseURL(res$url)</code>, the results can also be read directly in a browser.
One way of extracting the contents of the request is as follows:</p>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txt</span> <span class="op">=</span> <span class="fu"><a href="https://httr.r-lib.org/reference/content.html">content</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"text"</span><span class="op">)</span></span>
<span><span class="va">xml</span> <span class="op">=</span> <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_xml</a></span><span class="op">(</span><span class="va">txt</span><span class="op">)</span></span>
<span><span class="va">xml</span></span>
<span><span class="co">#&gt; {xml_document} ...</span></span>
<span><span class="co">#&gt; [1] &lt;ows:ServiceIdentification&gt;\n  &lt;ows:Title&gt;GeoServer WFS...</span></span>
<span><span class="co">#&gt; [2] &lt;ows:ServiceProvider&gt;\n  &lt;ows:ProviderName&gt;UN-FAO Fishe...</span></span>
<span><span class="co">#&gt; ...</span></span></code></pre></div>
<p>Data can be downloaded from WFS services with the <code>GetFeature</code> request and a specific <code>typeName</code> (as illustrated in the code chunk below).</p>
<p>Available names differ depending on the accessed web feature service.
One can extract them programmatically using web technologies <span class="citation">(<a href="references.html#ref-nolan_xml_2014">Nolan and Lang 2014</a>)</span> or scrolling manually through the contents of the <code>GetCapabilities</code> output in a browser.</p>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">qf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>request <span class="op">=</span> <span class="st">"GetFeature"</span>, typeName <span class="op">=</span> <span class="st">"fifao:FAO_MAJOR"</span><span class="op">)</span></span>
<span><span class="va">file</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".gml"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html">GET</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">base_url</span>, path <span class="op">=</span> <span class="va">endpoint</span>, query <span class="op">=</span> <span class="va">qf</span>, <span class="fu"><a href="https://httr.r-lib.org/reference/write_disk.html">write_disk</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fao_areas</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span></code></pre></div>
<p>In order to keep geometry validity along the data access chain, and since standards and underlying open-source server solutions (such as GeoServer) have been built on the Simple Features access, it is important to deactivate the new default behavior introduced in <strong>sf</strong>, and to not use the S2 geometry model at data access time.
This is done with above code <code>sf::sf_use_s2(FALSE)</code>.
Also note the use of <code><a href="https://httr.r-lib.org/reference/write_disk.html">write_disk()</a></code> to ensure that the results are written to disk rather than loaded into memory, allowing them to be imported with <strong>sf</strong>.</p>
<p>For many everyday tasks, however, a higher-level interface may be more appropriate, and a number of R packages, and tutorials, have been developed precisely for this purpose.
The package <strong>ows4R</strong> has been developed for working with OWS services.
It provides a stable interface to common access services, such as the WFS, WCS for data, CSW for metadata, and WPS for processing.
The OGC services coverage is described in the README of the package, hosted at <a href="https://github.com/eblondel/ows4R?tab=readme-ov-file#ogc-standards-coverage-status">github.com/eblondel/ows4R</a>, with new standard protocols under investigation/development.</p>
<p>Based on the above example, the code below shows how to perform <code>getCapabilities</code> and <code>getFeatures</code> operations with this package.
The <strong>ows4R</strong> package relies on the principle of clients.
To interact with an OWS service (such as WFS), a client is created as follows:</p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eblondel/ows4R">ows4R</a></span><span class="op">)</span></span>
<span><span class="va">WFS</span> <span class="op">=</span> <span class="va">WFSClient</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="st">"https://www.fao.org/fishery/geoserver/wfs"</span>,</span>
<span>  serviceVersion <span class="op">=</span> <span class="st">"1.0.0"</span>,</span>
<span>  logger <span class="op">=</span> <span class="st">"INFO"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The operations are then accessible from this client object, e.g., <code>getCapabilities</code> or <code>getFeatures</code>.</p>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eblondel/ows4R">ows4R</a></span><span class="op">)</span></span>
<span><span class="va">caps</span> <span class="op">=</span> <span class="va">WFS</span><span class="op">$</span><span class="fu">getCapabilities</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">features</span> <span class="op">=</span> <span class="va">WFS</span><span class="op">$</span><span class="fu">getFeatures</span><span class="op">(</span><span class="st">"fifao:FAO_MAJOR"</span><span class="op">)</span></span></code></pre></div>
<p>As explained before, when accessing data with OGC services, handling <strong>sf</strong> features should be done by deactivating the new default behavior introduced in <strong>sf</strong>, with <code>sf::sf_use_s2(FALSE)</code>.
This is done by default with <strong>ows4R</strong>.</p>
<p>Additional examples are available through vignettes, such as <a href="https://cran.r-project.org/web/packages/ows4R/vignettes/wcs.html">how to access raster data with the WCS</a>, or <a href="https://cran.r-project.org/web/packages/ows4R/vignettes/csw.html">how to access metadata with the CSW</a>.</p>
</div>
<div id="visual-outputs" class="section level2" number="8.9">
<h2>
<span class="header-section-number">8.9</span> Visual outputs<a class="anchor" aria-label="anchor" href="#visual-outputs"><i class="fas fa-link"></i></a>
</h2>
<p>
R supports many different static and interactive graphics formats.
Chapter <a href="adv-map.html#adv-map">9</a> covers map-making in detail, but it is worth mentioning ways to output visualizations here.
The most general method to save a static plot is to open a graphic device, create a plot, and close it, for example:</p>
<div class="sourceCode" id="cb294"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"lifeExp.png"</span>, width <span class="op">=</span> <span class="fl">500</span>, height <span class="op">=</span> <span class="fl">350</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">world</span><span class="op">[</span><span class="st">"lifeExp"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Other available graphic devices include <code><a href="https://rdrr.io/r/grDevices/pdf.html">pdf()</a></code>, <code><a href="https://rdrr.io/r/grDevices/png.html">bmp()</a></code>, <code><a href="https://rdrr.io/r/grDevices/png.html">jpeg()</a></code>, and <code><a href="https://rdrr.io/r/grDevices/png.html">tiff()</a></code>.
You can specify several properties of the output plot, including width, height and resolution.</p>
<p>
Additionally, several graphic packages provide their own functions to save a graphical output.
For example, the <strong>tmap</strong> package has the <code><a href="https://r-tmap.github.io/tmap/reference/tmap_save.html">tmap_save()</a></code> function.
You can save a <code>tmap</code> object to different graphic formats or an HTML file by specifying the object name and a file path to a new file.</p>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap">tmap</a></span><span class="op">)</span></span>
<span><span class="va">tmap_obj</span> <span class="op">=</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">world</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"lifeExp"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_save.html">tmap_save</a></span><span class="op">(</span><span class="va">tmap_obj</span>, filename <span class="op">=</span> <span class="st">"lifeExp_tmap.png"</span><span class="op">)</span></span></code></pre></div>
<p>On the other hand, you can save interactive maps created in the <strong>mapview</strong> package as an HTML file or image using the <code><a href="https://rdrr.io/pkg/mapview/man/mapshot.html">mapshot2()</a></code> function:</p>
<div class="sourceCode" id="cb296"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview">mapview</a></span><span class="op">)</span></span>
<span><span class="va">mapview_obj</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html">mapview</a></span><span class="op">(</span><span class="va">world</span>, zcol <span class="op">=</span> <span class="st">"lifeExp"</span>, legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapshot.html">mapshot2</a></span><span class="op">(</span><span class="va">mapview_obj</span>, url <span class="op">=</span> <span class="st">"my_interactive_map.html"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="exercises-6" class="section level2" number="8.10">
<h2>
<span class="header-section-number">8.10</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-6"><i class="fas fa-link"></i></a>
</h2>
<p>E1. List and describe three types of vector, raster, and geodatabase formats.</p>
<p>E2. Name at least two differences between the <strong>sf</strong> functions <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code> and <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read()</a></code>.</p>
<p>E3. Read the <code>cycle_hire_xy.csv</code> file from the <strong>spData</strong> package as a spatial object (Hint: it is located in the <code>misc</code> folder).
What is a geometry type of the loaded object?</p>
<p>E4. Download the borders of Germany using <strong>rnaturalearth</strong>, and create a new object called <code>germany_borders</code>.
Write this new object to a file of the GeoPackage format.</p>
<p>E5. Download the global monthly minimum temperature with a spatial resolution of 5 minutes using the <strong>geodata</strong> package.
Extract the June values, and save them to a file named <code>tmin_june.tif</code> file (hint: use <code><a href="https://rspatial.github.io/terra/reference/subset.html">terra::subset()</a></code>).</p>
<p>E6. Create a static map of Germany’s borders, and save it to a PNG file.</p>
<p>E7. Create an interactive map using data from the <code>cycle_hire_xy.csv</code> file.
Export this map to a file called <code>cycle_hire.html</code>.</p>

</div>
</div>




  <div class="chapter-nav">
<div class="prev"><a href="reproj-geo-data.html"><span class="header-section-number">7</span> Reprojecting geographic data</a></div>
<div class="next"><a href="adv-map.html"><span class="header-section-number">9</span> Making maps with R</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <h2>Second Edition</h2>
    <!--<p>Now is a great time to provide feedback</p>-->
        <ul class="list-unstyled">
<!--<li><a href="https://forms.gle/nq9RmbxJyZXQgc948">Provide feedback (5 min)</a></li>--><li><a href="https://geocompx.org/">Visit the geocompx website 🌐</a></li>
          <li><a href="https://r.geocompx.org/#reproducibility">Install updated packages 💾</a></li>
          <li><a href="https://github.com/geocompx/geocompr/issues">Open an issue <i class="fas fa-question"></i></a></li>
          <li><a href="https://discord.gg/PMztXYgNxp">Chat on Discord <i class="fab fa-discord"></i></a></li>
          <li><a href="https://r.geocompx.org/solutions/">Check exercise solutions <i class="fa fa-check"></i></a></li>
          <li><a href="https://supportukrainenow.org/">Support Ukraine 🇺🇦</a></li>
          <li><a href="https://donate.stripe.com/4gweWl94Q9E35AQ6oo">Support this project 💸</a></li>
        </ul>
<hr>
<nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#read-write"><span class="header-section-number">8</span> Geographic data I/O</a></li>
<li><a class="nav-link" href="#prerequisites-6">Prerequisites</a></li>
<li><a class="nav-link" href="#introduction-4"><span class="header-section-number">8.1</span> Introduction</a></li>
<li><a class="nav-link" href="#file-formats"><span class="header-section-number">8.2</span> File formats</a></li>
<li>
<a class="nav-link" href="#data-input"><span class="header-section-number">8.3</span> Data input (I)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#iovec"><span class="header-section-number">8.3.1</span> Vector data</a></li>
<li><a class="nav-link" href="#raster-data-read"><span class="header-section-number">8.3.2</span> Raster data</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#data-output"><span class="header-section-number">8.4</span> Data output (O)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#vector-data-1"><span class="header-section-number">8.4.1</span> Vector data</a></li>
<li><a class="nav-link" href="#raster-data-write"><span class="header-section-number">8.4.2</span> Raster data</a></li>
</ul>
</li>
<li><a class="nav-link" href="#retrieving-data"><span class="header-section-number">8.5</span> Geoportals</a></li>
<li><a class="nav-link" href="#geographic-data-packages"><span class="header-section-number">8.6</span> Geographic data packages</a></li>
<li><a class="nav-link" href="#geographic-metadata"><span class="header-section-number">8.7</span> Geographic metadata</a></li>
<li><a class="nav-link" href="#geographic-web-services"><span class="header-section-number">8.8</span> Geographic web services</a></li>
<li><a class="nav-link" href="#visual-outputs"><span class="header-section-number">8.9</span> Visual outputs</a></li>
<li><a class="nav-link" href="#exercises-6"><span class="header-section-number">8.10</span> Exercises</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/geocompx/geocompr/blob/main/08-read-write-plot.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/geocompx/geocompr/edit/main/08-read-write-plot.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Geocomputation with R</strong>" was written by Robin Lovelace, Jakub Nowosad, Jannes Muenchow. It was last built on 2025-07-09.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
